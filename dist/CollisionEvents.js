var CollisionEvents;(()=>{"use strict";var t={28:(t,e,n)=>{n.d(e,{getDefaultAttributeForTarget:()=>o,getTransformCoordsFromElement:()=>a});var i=n(19);const s=new Map,r=new Map;function o(t,e){r.has(t)||r.set(t,new Map);let n="";const i=r.get(t);return n=(i.has(e)?i.get(e):t.getAttribute(e))||"",function(t,e,n){r.has(t)||r.set(t,new Map),r.get(t).set(e,n)}(t,e,n),n}function a(t){const e=(window.getComputedStyle(t).transform.match(i.regexNumberPattern)??[0,0]).map((t=>+t));return{x:void 0!==e[4]?Math.round(e[4]):0,y:void 0!==e[5]?Math.round(e[5]):0}}window.addEventListener("keydown",(t=>{for(const e of s)t.code===e[0]&&e[1].forEach((e=>e(t)))}))},513:(t,e,n)=>{n.d(e,{getElementsInteractingSet:()=>a,isValidTargetToTriggerEvent:()=>o,mapTargetsCollidingByTriggerElement:()=>s}),n(28);var i=n(676);new Map;const s=new Map,r=new Map;function o(t,e,n){return!!t.classList.contains(e)&&(!n||!new i.CollisionBorderDistanceExtras(n.distanceFromBorder).anyLowerThan(n.distanceThreshold))}function a(t){return r.has(t)||r.set(t,new Set),r.get(t)}new Map},19:(t,e,n)=>{n.d(e,{regexNumberPattern:()=>i});const i=/-?\d+\.?\d*/g},444:(t,e,n)=>{n.d(e,{PinCollisionEvent:()=>r});var i=n(28),s=n(513);class r{onPin;onUnpin;pinPositionFormula;targetClass="pin-target";autoInsertTargetClass=!0;constructor({pinPositionFormula:t,onPin:e,onUnpin:n}){this.pinPositionFormula=t||void 0,this.onPin=e||void 0,this.onUnpin=n||void 0}async onColliding(t,e,n,r){if(!(0,s.isValidTargetToTriggerEvent)(e,this.targetClass))return;const o=(0,s.getElementsInteractingSet)(e),a="total-pinned-elements";if(t.classList.contains("dragging"))return t.classList.remove("pinned"),t.classList.add("ready-to-pin"),void(o.delete(t)&&(this.onElementInteractionChange(e,o,a),!this.onUnpin||this.onUnpin(t,e)));this.pinPositionFormula?function(t,e,n,s){const r=e.getBoundingClientRect(),o=s(t.getBoundingClientRect(),r,(0,i.getTransformCoordsFromElement)(t),n);t.style.transform=`translate(${o.x}px, ${o.y}px)`}(t,e,r,this.pinPositionFormula):function(t,e,n){const s=e.getBoundingClientRect(),r=(0,i.getTransformCoordsFromElement)(t),o=r.x+n.right,a=r.y+n.bottom;t.style.transform=`translate(${Math.round(o-s.width/2)}px, ${Math.round(a-s.height/2)}px)`}(t,e,r),o.has(t)||(o.add(t),!this.onPin||this.onPin(t,e)),t.classList.add("pinned"),t.classList.remove("ready-to-pin"),this.onElementInteractionChange(e,o,a)}async onNotColliding(t,e){const n=(0,s.getElementsInteractingSet)(e);n.delete(t),n.size>0?e.classList.add("has-pinned-elements"):e.classList.remove("has-pinned-elements"),s.mapTargetsCollidingByTriggerElement.has(t)||s.mapTargetsCollidingByTriggerElement.set(t,new Set);const i=s.mapTargetsCollidingByTriggerElement.get(t);i.delete(e)&&0===i.size&&t.classList.remove("pinned","ready-to-pin")}onElementInteractionChange(t,e,n){e.size>0?t.classList.add("has-pinned-elements"):t.classList.remove("has-pinned-elements"),t.setAttribute(n,e.size.toString())}}},579:(t,e,n)=>{n.d(e,{ShareAttributeCollisionEvent:()=>o});var i=n(28),s=n(513);const r={keepAttribute:!1};class o{keepAttribute;targetClass="attribute-target";autoInsertTargetClass=!0;constructor(t=r){this.keepAttribute=t.keepAttribute||!1}async onColliding(t,e,n,i){const r=t.getAttribute("shared-attribute-name"),o=t.getAttribute("shared-attribute-value");if(!o||!r||!(0,s.isValidTargetToTriggerEvent)(e,this.targetClass))return;const a=(0,s.getElementsInteractingSet)(e),l="total-sharing-attributes";t.classList.contains("dragging")?(t.classList.remove("sharing-attribute"),t.classList.add("ready-to-share-attribute"),this.handleElementInteractionShareAttribute(t,e,a,l)):(t.classList.add("sharing-attribute"),t.classList.remove("ready-to-share-attribute"),e.setAttribute(r,o),a.add(t),this.handleElementInteractionShareAttribute(t,e,a,l))}async onNotColliding(t,e){(0,s.getElementsInteractingSet)(e).size>0?e.classList.add("sharing-attribute"):this.onSharedAttributeEmpty(t,e),s.mapTargetsCollidingByTriggerElement.has(t)||s.mapTargetsCollidingByTriggerElement.set(t,new Set);const n=s.mapTargetsCollidingByTriggerElement.get(t);(n.delete(e)||0===n.size)&&t.classList.remove("sharing-attribute","ready-to-share-attribute")}handleElementInteractionShareAttribute(t,e,n,i){n.size>0?e.classList.add("sharing-attribute"):this.onSharedAttributeEmpty(t,e),e.setAttribute(i,n.size.toString())}onSharedAttributeEmpty(t,e){e.classList.remove("sharing-attribute");const n=t.getAttribute("shared-attribute-name");if(n){const t=(0,i.getDefaultAttributeForTarget)(e,n);t?e.setAttribute(n,t):this.keepAttribute||e.removeAttribute(n)}}}},676:(t,e,n)=>{var i,s,r,o;n.d(e,{CollisionBorderDistanceExtras:()=>a}),function(t){t[t.PIXEL=0]="PIXEL",t[t.PERCENTAGE=1]="PERCENTAGE"}(i||(i={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(s||(s={})),function(t){t[t.FROM_TOP=0]="FROM_TOP",t[t.FROM_BOTTOM=1]="FROM_BOTTOM"}(r||(r={})),function(t){t[t.R=0]="R",t[t.G=1]="G",t[t.B=2]="B",t[t.A=3]="A"}(o||(o={}));class a{collisionBorderDistances;constructor(t){this.collisionBorderDistances=t}anyGreaterThan(t){return this.collisionBorderDistances.top>t||this.collisionBorderDistances.right>t||this.collisionBorderDistances.bottom>t||this.collisionBorderDistances.left>t}anyLowerThan(t){return this.collisionBorderDistances.top<t||this.collisionBorderDistances.right<t||this.collisionBorderDistances.bottom<t||this.collisionBorderDistances.left<t}anyEquals(t){return this.collisionBorderDistances.top===t||this.collisionBorderDistances.right===t||this.collisionBorderDistances.bottom===t||this.collisionBorderDistances.left===t}}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{n.r(i),n.d(i,{PinCollisionEvent:()=>t.PinCollisionEvent,ShareAttributeCollisionEvent:()=>e.ShareAttributeCollisionEvent});var t=n(444),e=n(579)})(),CollisionEvents=i})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29sbGlzaW9uRXZlbnRzLmpzIiwibWFwcGluZ3MiOiJ1SkFLTyxNQUFNQSxFQUFtQixJQUFJQyxJQXdCdkJDLEVBQWdDLElBQUlELElBQzFDLFNBQVNFLEVBQThCQyxFQUFxQkMsR0FDM0RILEVBQThCSSxJQUFLRixJQUN2Q0YsRUFBOEJLLElBQUtILEVBQVEsSUFBSUgsS0FHakQsSUFBSU8sRUFBaUIsR0FDckIsTUFBTUMsRUFBK0JQLEVBQThCUSxJQUFLTixHQU14RSxPQUhBSSxHQUZnQ0MsRUFBNkJILElBQUtELEdBQXlESSxFQUE2QkMsSUFBS0wsR0FBekVELEVBQU9PLGFBQWNOLEtBRTlDLEdBTXRELFNBQXVDRCxFQUFxQkMsRUFBdUJPLEdBQ2xGVixFQUE4QkksSUFBS0YsSUFDdkNGLEVBQThCSyxJQUFLSCxFQUFRLElBQUlILEtBR2pEQyxFQUE4QlEsSUFBS04sR0FBVUcsSUFBS0YsRUFBZU8sRUFDbkUsQ0FYRUMsQ0FBOEJULEVBQVFDLEVBQWVHLEdBRTlDQSxDQUNULENBb0RPLFNBQVNNLEVBQStCQyxHQUM3QyxNQUFNQyxHQUFrQ0MsT0FBT0MsaUJBQWtCSCxHQUFVSSxVQUFVQyxNQUFPLEVBQUFDLHFCQUF3QixDQUFDLEVBQUcsSUFBS0MsS0FBS0MsSUFBTUEsSUFDeEksTUFBTyxDQUNMQyxPQUF3Q0MsSUFBckNULEVBQThCLEdBQW1CVSxLQUFLQyxNQUFPWCxFQUE4QixJQUFPLEVBQ3JHWSxPQUF3Q0gsSUFBckNULEVBQThCLEdBQW1CVSxLQUFLQyxNQUFPWCxFQUE4QixJQUFPLEVBRXpHLENBZEFDLE9BQU9ZLGlCQUFrQixXQUFXQyxJQUNsQyxJQUFNLE1BQU1DLEtBQVEvQixFQUNiOEIsRUFBSUUsT0FBU0QsRUFBSyxJQUNyQkEsRUFBSyxHQUFHRSxTQUFTQyxHQUFXQSxFQUFTSixJLDJKQ3ZGRSxJQUFJN0IsSUFBMUMsTUFDTWtDLEVBQXNDLElBQUlsQyxJQUMxQ21DLEVBQXNDLElBQUluQyxJQXFKaEQsU0FBU29DLEVBQTZCQyxFQUE0QkMsRUFBeUJDLEdBQ2hHLFFBQU1GLEVBQWNHLFVBQVVDLFNBQVVILE1BSW5DQyxJQUVtQyxJQUFJLEVBQUFHLDhCQUErQkgsRUFBaUJJLG9CQUN2REMsYUFBY0wsRUFBaUJNLG1CQU10RSxDQUVPLFNBQVNDLEVBQTJCM0MsR0FLekMsT0FKTWdDLEVBQW9DOUIsSUFBS0YsSUFDN0NnQyxFQUFvQzdCLElBQUtILEVBQVEsSUFBSTRDLEtBR2hEWixFQUFvQzFCLElBQUtOLEVBQ2xELENBeEttQyxJQUFJSCxHLGlEQ1JoQyxNQUFNb0IsRUFBcUIsYyxzRUNTM0IsTUFBTTRCLEVBQ0hDLE1BQ0FDLFFBQ0FDLG1CQUVEQyxZQUFzQixhQUN0QkMsdUJBQWlDLEVBRXhDLFdBQUFDLEVBQWEsbUJBQUVILEVBQWtCLE1BQUVGLEVBQUssUUFBRUMsSUFDeENLLEtBQUtKLG1CQUFxQkEsUUFBc0IzQixFQUNoRCtCLEtBQUtOLE1BQVFBLFFBQVN6QixFQUN0QitCLEtBQUtMLFFBQVVBLFFBQVcxQixDQUM1QixDQUVPLGlCQUFNZ0MsQ0FBYUMsRUFBd0J0RCxFQUFxQnVELEVBQXVDZixHQUM1RyxLQUFNLElBQUFQLDZCQUE2QmpDLEVBQVFvRCxLQUFLSCxhQUM5QyxPQUdGLE1BQU1PLEdBQTJDLElBQUFiLDJCQUEyQjNDLEdBQ3RFeUQsRUFBd0Msd0JBQzlDLEdBQUtILEVBQVVqQixVQUFVQyxTQUFVLFlBU2pDLE9BUkFnQixFQUFVakIsVUFBVXFCLE9BQVEsVUFDNUJKLEVBQVVqQixVQUFVc0IsSUFBSyxxQkFFcEJILEVBQXVCSSxPQUFRTixLQUNsQ0YsS0FBS1MsMkJBQTRCN0QsRUFBUXdELEVBQXdCQyxJQUNqRUwsS0FBS0wsU0FBVUssS0FBS0wsUUFBU08sRUFBV3RELEtBTXZDb0QsS0FBS0osbUJBZ0RQLFNBQWdDTSxFQUF3QnRELEVBQXFCd0MsRUFBNkNRLEdBQy9ILE1BQU1jLEVBQWE5RCxFQUFPK0Qsd0JBR3BCQyxFQUF1QmhCLEVBRlBNLEVBQVVTLHdCQUVnQ0QsR0FEN0IsSUFBQXBELCtCQUErQjRDLEdBQ3NDZCxHQUN4R2MsRUFBVVcsTUFBTWxELFVBQVksYUFBY2lELEVBQVk1QyxRQUFVNEMsRUFBWXhDLE1BQzlFLENBckRNMEMsQ0FBdUJaLEVBQVd0RCxFQUFRd0MsRUFBb0JZLEtBQUtKLG9CQXVEbEUsU0FBK0JNLEVBQXdCdEQsRUFBcUJ3QyxHQUNqRixNQUFNc0IsRUFBYTlELEVBQU8rRCx3QkFDcEJJLEdBQTZCLElBQUF6RCwrQkFBK0I0QyxHQUM1RGMsRUFBc0JELEVBQTJCL0MsRUFBSW9CLEVBQW1CNkIsTUFDeEVDLEVBQXVCSCxFQUEyQjNDLEVBQUlnQixFQUFtQitCLE9BQy9FakIsRUFBVVcsTUFBTWxELFVBQVksYUFBY08sS0FBS0MsTUFBTzZDLEVBQXdCTixFQUFXVSxNQUFRLFNBQWNsRCxLQUFLQyxNQUFPK0MsRUFBeUJSLEVBQVdXLE9BQVMsT0FDMUssQ0EzRE1DLENBQXNCcEIsRUFBV3RELEVBQVF3QyxHQUdyQ2dCLEVBQXVCdEQsSUFBS29ELEtBQ2hDRSxFQUF1QkcsSUFBS0wsSUFDNUJGLEtBQUtOLE9BQVFNLEtBQUtOLE1BQU9RLEVBQVd0RCxJQUl0Q3NELEVBQVVqQixVQUFVc0IsSUFBSyxVQUN6QkwsRUFBVWpCLFVBQVVxQixPQUFRLGdCQUM1Qk4sS0FBS1MsMkJBQTRCN0QsRUFBUXdELEVBQXdCQyxFQUNuRSxDQUVPLG9CQUFNa0IsQ0FBZ0JyQixFQUF3QnRELEdBQ25ELE1BQU13RCxHQUEyQyxJQUFBYiwyQkFBMkIzQyxHQUM1RXdELEVBQXVCSSxPQUFRTixHQUUxQkUsRUFBdUJvQixLQUFPLEVBQ2pDNUUsRUFBT3FDLFVBQVVzQixJQUFLLHVCQUV0QjNELEVBQU9xQyxVQUFVcUIsT0FBUSx1QkFHckIsRUFBQTNCLG9DQUFvQzdCLElBQUtvRCxJQUM3QyxFQUFBdkIsb0NBQW9DNUIsSUFBS21ELEVBQVcsSUFBSVYsS0FHMUQsTUFBTWlDLEVBQW9CLEVBQUE5QyxvQ0FBb0N6QixJQUFLZ0QsR0FDOUR1QixFQUFrQmpCLE9BQVE1RCxJQUFzRCxJQUEzQjZFLEVBQWtCRCxNQUMxRXRCLEVBQVVqQixVQUFVcUIsT0FBUSxTQUFVLGVBRTFDLENBRVEsMEJBQUFHLENBQTRCN0QsRUFBcUJ3RCxFQUEwQ0MsR0FDNUZELEVBQXVCb0IsS0FBTyxFQUNqQzVFLEVBQU9xQyxVQUFVc0IsSUFBSyx1QkFFdEIzRCxFQUFPcUMsVUFBVXFCLE9BQVEsdUJBRzNCMUQsRUFBTzhFLGFBQWNyQixFQUF1Q0QsRUFBdUJvQixLQUFLRyxXQUMxRixFLGlGQzlFRixNQUFNQyxFQUE2QyxDQUNqREMsZUFBZSxHQUdWLE1BQU1DLEVBQ1hELGNBRU9oQyxZQUFzQixtQkFDdEJDLHVCQUFpQyxFQUV4QyxXQUFBQyxDQUFhZ0MsRUFBK0NILEdBQzFENUIsS0FBSzZCLGNBQWdCRSxFQUFRRixnQkFBaUIsQ0FDaEQsQ0FFTyxpQkFBTTVCLENBQWFDLEVBQXdCdEQsRUFBcUJ1RCxFQUF1QzZCLEdBRTVHLE1BQU1DLEVBQXNCL0IsRUFBVS9DLGFBQWMseUJBQzlDK0UsRUFBdUJoQyxFQUFVL0MsYUFBYywwQkFDckQsSUFBTStFLElBQXlCRCxLQUF3QixJQUFBcEQsNkJBQTZCakMsRUFBUW9ELEtBQUtILGFBQy9GLE9BR0YsTUFBTU8sR0FBMkMsSUFBQWIsMkJBQTJCM0MsR0FDdEV5RCxFQUF3QywyQkFFekNILEVBQVVqQixVQUFVQyxTQUFVLGFBQ2pDZ0IsRUFBVWpCLFVBQVVxQixPQUFRLHFCQUM1QkosRUFBVWpCLFVBQVVzQixJQUFLLDRCQUV6QlAsS0FBS21DLHVDQUF3Q2pDLEVBQVd0RCxFQUFRd0QsRUFBd0JDLEtBRXhGSCxFQUFVakIsVUFBVXNCLElBQUsscUJBQ3pCTCxFQUFVakIsVUFBVXFCLE9BQVEsNEJBRTVCMUQsRUFBTzhFLGFBQWNPLEVBQXFCQyxHQUUxQzlCLEVBQXVCRyxJQUFLTCxHQUM1QkYsS0FBS21DLHVDQUF3Q2pDLEVBQVd0RCxFQUFRd0QsRUFBd0JDLEdBRTVGLENBRU8sb0JBQU1rQixDQUFnQnJCLEVBQXdCdEQsSUFDRixJQUFBMkMsMkJBQTJCM0MsR0FFaEQ0RSxLQUFPLEVBQ2pDNUUsRUFBT3FDLFVBQVVzQixJQUFLLHFCQUV0QlAsS0FBS29DLHVCQUF3QmxDLEVBQVd0RCxHQUdwQyxFQUFBK0Isb0NBQW9DN0IsSUFBS29ELElBQzdDLEVBQUF2QixvQ0FBb0M1QixJQUFLbUQsRUFBVyxJQUFJVixLQUcxRCxNQUFNaUMsRUFBb0IsRUFBQTlDLG9DQUFvQ3pCLElBQUtnRCxJQUM5RHVCLEVBQWtCakIsT0FBUTVELElBQXNELElBQTNCNkUsRUFBa0JELE9BQzFFdEIsRUFBVWpCLFVBQVVxQixPQUFRLG9CQUFxQiwyQkFFckQsQ0FFTyxzQ0FBQTZCLENBQXdDakMsRUFBd0J0RCxFQUFxQndELEVBQTBDQyxHQUMvSEQsRUFBdUJvQixLQUFPLEVBQ2pDNUUsRUFBT3FDLFVBQVVzQixJQUFLLHFCQUV0QlAsS0FBS29DLHVCQUF3QmxDLEVBQVd0RCxHQUcxQ0EsRUFBTzhFLGFBQWNyQixFQUF1Q0QsRUFBdUJvQixLQUFLRyxXQUMxRixDQUVPLHNCQUFBUyxDQUF3QmxDLEVBQXdCdEQsR0FDckRBLEVBQU9xQyxVQUFVcUIsT0FBUSxxQkFHekIsTUFBTTJCLEVBQXNCL0IsRUFBVS9DLGFBQWMseUJBQ3BELEdBQUs4RSxFQUFzQixDQUN6QixNQUFNSSxHQUFtQyxJQUFBMUYsOEJBQThCQyxFQUFRcUYsR0FDMUVJLEVBQ0h6RixFQUFPOEUsYUFBY08sRUFBcUJJLEdBQy9CckMsS0FBSzZCLGVBQ2hCakYsRUFBTzBGLGdCQUFpQkwsRSxDQUc5QixFLGdCQzFGRixJQUFZTSxFQUNBQyxFQUNBQyxFQUVBQyxFLDZDQUpaLFNBQVlILEdBQWtCLHFCQUFPLDhCQUFZLENBQWpELENBQVlBLElBQUFBLEVBQWUsS0FDM0IsU0FBWUMsR0FBc0IsK0JBQVksMEJBQVUsQ0FBeEQsQ0FBWUEsSUFBQUEsRUFBbUIsS0FDL0IsU0FBWUMsR0FBcUIsMkJBQVUsZ0NBQWEsQ0FBeEQsQ0FBWUEsSUFBQUEsRUFBa0IsS0FFOUIsU0FBWUMsR0FBZ0IsYUFBRyxhQUFHLGFBQUcsWUFBRyxDQUF4QyxDQUFZQSxJQUFBQSxFQUFhLEtBbUVsQixNQUFNdkQsRUFDWHdELHlCQUVBLFdBQUE1QyxDQUFhNkMsR0FDWDVDLEtBQUsyQyx5QkFBMkJDLENBQ2xDLENBRU8sY0FBQUMsQ0FBZ0JDLEdBQ3JCLE9BQU85QyxLQUFLMkMseUJBQXlCSSxJQUFNRCxHQUN0QzlDLEtBQUsyQyx5QkFBeUIxQixNQUFRNkIsR0FDdEM5QyxLQUFLMkMseUJBQXlCeEIsT0FBUzJCLEdBQ3ZDOUMsS0FBSzJDLHlCQUF5QkssS0FBT0YsQ0FDNUMsQ0FFTyxZQUFBekQsQ0FBY3lELEdBQ25CLE9BQU85QyxLQUFLMkMseUJBQXlCSSxJQUFNRCxHQUN0QzlDLEtBQUsyQyx5QkFBeUIxQixNQUFRNkIsR0FDdEM5QyxLQUFLMkMseUJBQXlCeEIsT0FBUzJCLEdBQ3ZDOUMsS0FBSzJDLHlCQUF5QkssS0FBT0YsQ0FDNUMsQ0FFTyxTQUFBRyxDQUFXSCxHQUNoQixPQUFPOUMsS0FBSzJDLHlCQUF5QkksTUFBUUQsR0FDeEM5QyxLQUFLMkMseUJBQXlCMUIsUUFBVTZCLEdBQ3hDOUMsS0FBSzJDLHlCQUF5QnhCLFNBQVcyQixHQUN6QzlDLEtBQUsyQyx5QkFBeUJLLE9BQVNGLENBQzlDLEUsR0NsR0VJLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQm5GLElBQWpCb0YsRUFDSCxPQUFPQSxFQUFhQyxRQUdyQixJQUFJQyxFQUFTTCxFQUF5QkUsR0FBWSxDQUdqREUsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JKLEdBQVVHLEVBQVFBLEVBQU9ELFFBQVNILEdBRy9DSSxFQUFPRCxPQUNmLENDckJBSCxFQUFvQk0sRUFBSSxDQUFDSCxFQUFTSSxLQUNqQyxJQUFJLElBQUlDLEtBQU9ELEVBQ1hQLEVBQW9CUyxFQUFFRixFQUFZQyxLQUFTUixFQUFvQlMsRUFBRU4sRUFBU0ssSUFDNUVFLE9BQU9DLGVBQWVSLEVBQVNLLEVBQUssQ0FBRUksWUFBWSxFQUFNN0csSUFBS3dHLEVBQVdDLElBRTFFLEVDTkRSLEVBQW9CUyxFQUFJLENBQUNJLEVBQUtDLElBQVVKLE9BQU9LLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDQ2xGZCxFQUFvQmtCLEVBQUtmLElBQ0gsb0JBQVhnQixRQUEwQkEsT0FBT0MsYUFDMUNWLE9BQU9DLGVBQWVSLEVBQVNnQixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RYLE9BQU9DLGVBQWVSLEVBQVMsYUFBYyxDQUFFa0IsT0FBTyxHQUFPLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ET01Ub29scy50cyIsIndlYnBhY2s6Ly8vLi9EcmFnZ2FibGVBY3Rpb24udHMiLCJ3ZWJwYWNrOi8vLy4vTWF0aFRvb2xzLnRzIiwid2VicGFjazovLy8uL1BpbkNvbGxpc2lvbkV2ZW50LnRzIiwid2VicGFjazovLy8uL1NoYXJlQXR0cmlidXRlQ29sbGlzaW9uRXZlbnQudHMiLCJ3ZWJwYWNrOi8vLy4vdHlwZXMudHMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9pbnQyRCwgcmVnZXhOdW1iZXJQYXR0ZXJuIH0gZnJvbSAnLi9NYXRoVG9vbHMnO1xyXG5pbXBvcnQgeyBDb2xsaXNpb25EaXJlY3Rpb25DaGVjaywgQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCB0eXBlIEtleWJvYXJkRXZlbnRDYWxsYmFjayA9ICggZXZ0OiBLZXlib2FyZEV2ZW50ICkgPT4gdm9pZDtcclxuXHJcbmV4cG9ydCBjb25zdCBkaWN0S2V5c0J5QWN0aW9uID0gbmV3IE1hcDxzdHJpbmcsIEtleWJvYXJkRXZlbnRDYWxsYmFja1tdPigpO1xyXG5leHBvcnQgZnVuY3Rpb24gYWRkQWN0aW9uS2V5KCBrZXk6IHN0cmluZywgZXZlbnQ6IEtleWJvYXJkRXZlbnRDYWxsYmFjayApIHtcclxuICBpZiAoIGRpY3RLZXlzQnlBY3Rpb24uaGFzKCBrZXkgKSApIHtcclxuICAgIGRpY3RLZXlzQnlBY3Rpb24uc2V0KCBrZXksIFtldmVudCwgLi4uZGljdEtleXNCeUFjdGlvbi5nZXQoIGtleSApIV0gKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uLnNldCgga2V5LCBbZXZlbnRdIClcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjaGVja0VsZW1lbnRDb2xsaXNpb24oIGVsZW1lbnQxOiBIVE1MRWxlbWVudCwgZWxlbWVudDI6IEhUTUxFbGVtZW50ICk6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IHJlY3QxID0gZWxlbWVudDEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgY29uc3QgcmVjdDIgPSBlbGVtZW50Mi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgcmV0dXJuICEoXHJcbiAgICByZWN0MS50b3AgPiByZWN0Mi5ib3R0b20gfHxcclxuICAgIHJlY3QxLnJpZ2h0IDwgcmVjdDIubGVmdCB8fFxyXG4gICAgcmVjdDEuYm90dG9tIDwgcmVjdDIudG9wIHx8XHJcbiAgICByZWN0MS5sZWZ0ID4gcmVjdDIucmlnaHRcclxuICApO1xyXG59XHJcblxyXG4vLy8gR2V0IHRoZSBkZWZhdWx0IGF0dHJpYnV0ZXMgZnJvbSB0aGUgdGFyZ2V0IGVsZW1lbnRcclxuLy8vIElmIGhhdmUgbm90IGRlZmF1bHQgYXR0cmlidXRlIHdpdGggdGhpcyBAYXR0cmlidXRlTmFtZSBvbiBtYXAgd2lsbCBzZXQgdGhlIGN1cnJlbnQgYXR0cmlidXRlIGFzIGRlZmF1bHRcclxuLy8vIElmIGhhdmUgbm90IGRlZmF1bHQgYXR0cmlidXRlIHdpdGggdGhpcyBAYXR0cmlidXRlTmFtZSB3aWxsIHJldHVybiBhbiBlbXB0eSBzdHJpbmdcclxuZXhwb3J0IGNvbnN0IG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50ID0gbmV3IE1hcDxIVE1MRWxlbWVudCwgTWFwPHN0cmluZywgc3RyaW5nPj4oKTtcclxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQoIHRhcmdldDogSFRNTEVsZW1lbnQsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZyApOiBzdHJpbmcge1xyXG4gIGlmICggIW1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5zZXQoIHRhcmdldCwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSApO1xyXG4gIH1cclxuXHJcbiAgbGV0IHJlc3VsdDogc3RyaW5nID0gJyc7XHJcbiAgY29uc3QgZGVmYXVsdEF0dHJpYnV0ZVZhbHVlc0J5TmFtZSA9IG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmdldCggdGFyZ2V0ICkhO1xyXG4gIGNvbnN0IHRhcmdldERlZmF1bHRBdHRyaWJ1dGUgPSAhZGVmYXVsdEF0dHJpYnV0ZVZhbHVlc0J5TmFtZS5oYXMoIGF0dHJpYnV0ZU5hbWUgKSA/IHRhcmdldC5nZXRBdHRyaWJ1dGUoIGF0dHJpYnV0ZU5hbWUgKSA6IGRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXNCeU5hbWUuZ2V0KCBhdHRyaWJ1dGVOYW1lICkhO1xyXG5cclxuICByZXN1bHQgPSB0YXJnZXREZWZhdWx0QXR0cmlidXRlID8gdGFyZ2V0RGVmYXVsdEF0dHJpYnV0ZSA6ICcnO1xyXG4gIHNldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQoIHRhcmdldCwgYXR0cmlidXRlTmFtZSwgcmVzdWx0ICk7XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXREZWZhdWx0QXR0cmlidXRlRm9yVGFyZ2V0KCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcsIG5ld0RlZmF1bHRBdHRyaWJ1dGU6IHN0cmluZyApOiB2b2lkIHtcclxuICBpZiAoICFtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5oYXMoIHRhcmdldCApICkge1xyXG4gICAgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuc2V0KCB0YXJnZXQsIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCkgKTtcclxuICB9XHJcblxyXG4gIG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmdldCggdGFyZ2V0ICkhLnNldCggYXR0cmlidXRlTmFtZSwgbmV3RGVmYXVsdEF0dHJpYnV0ZSApO1xyXG59XHJcblxyXG4vLy8gRGl2aWRlIG8gZWxlbWVudG8gQHRhcmdldCBlbSA5IFwicXVhZHJhZG9zXCIgaWd1YWlzIGUgcmV0b3JuYSBlbSBxdWFpcyBxdWFkcmFkb3MgbyBkcmFnZ2FibGUgZXN0w6EgY29saWRpbmRvIGNvbSBvIHRhcmdldFxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q29sbGlzaW9uRGlyZWN0aW9uKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICk6IENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrIHtcclxuICBjb25zdCByZWN0MSA9IGRyYWdnYWJsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICBjb25zdCByZWN0MiA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgY29uc3QgaXNUb3AgPSByZWN0MS5ib3R0b20gPiByZWN0Mi50b3AgJiYgcmVjdDEudG9wIDwgcmVjdDIudG9wICsgcmVjdDIuaGVpZ2h0IC8gMztcclxuICBjb25zdCBpc1JpZ2h0ID0gcmVjdDEubGVmdCA8IHJlY3QyLnJpZ2h0ICYmIHJlY3QxLnJpZ2h0ID4gcmVjdDIucmlnaHQgLSByZWN0Mi53aWR0aCAvIDM7XHJcbiAgY29uc3QgaXNDZW50ZXIgPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gJiYgcmVjdDEuYm90dG9tID4gcmVjdDIudG9wICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5yaWdodCAmJiByZWN0MS5yaWdodCA+IHJlY3QyLmxlZnQ7XHJcbiAgY29uc3QgaXNCb3R0b20gPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gLSByZWN0Mi5oZWlnaHQgLyAzICYmIHJlY3QxLmJvdHRvbSA+IHJlY3QyLmJvdHRvbSAtIHJlY3QyLmhlaWdodCAvIDM7XHJcbiAgY29uc3QgaXNMZWZ0ID0gcmVjdDEucmlnaHQgPiByZWN0Mi5sZWZ0ICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5sZWZ0ICsgcmVjdDIud2lkdGggLyAzO1xyXG5cclxuICByZXR1cm4geyB0b3A6IGlzVG9wLCByaWdodDogaXNSaWdodCwgY2VudGVyOiBpc0NlbnRlciwgYm90dG9tOiBpc0JvdHRvbSwgbGVmdDogaXNMZWZ0IH07XHJcbn1cclxuXHJcbi8vLyByZXR1cm4gdGhlIGRpc3RhbmNlIGZyb20gdGhlIGNlbnRlciBvZiB0aGUgZHJhZ2dhYmxlIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRhcmdldCBlbGVtZW50IGZyb20gZWFjaCBib3JkZXIgXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREaXN0YW5jZUZyb21Cb3JkZXIoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQgKTogQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2Uge1xyXG4gIGNvbnN0IHJlY3QxID0gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IHJlY3QyID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICBjb25zdCBjZW50ZXIgPSB7XHJcbiAgICB4OiByZWN0MS5sZWZ0ICsgcmVjdDEud2lkdGggLyAyLFxyXG4gICAgeTogcmVjdDEudG9wICsgcmVjdDEuaGVpZ2h0IC8gMixcclxuICB9O1xyXG5cclxuICBjb25zdCBkaXN0YW5jZUZyb21Cb3JkZXI6IENvbGxpc2lvbkJvcmRlckRpc3RhbmNlID0ge1xyXG4gICAgdG9wOiBjZW50ZXIueSAtIHJlY3QyLnRvcCxcclxuICAgIHJpZ2h0OiByZWN0Mi5yaWdodCAtIGNlbnRlci54LFxyXG4gICAgYm90dG9tOiByZWN0Mi5ib3R0b20gLSBjZW50ZXIueSxcclxuICAgIGxlZnQ6IGNlbnRlci54IC0gcmVjdDIubGVmdCxcclxuICB9O1xyXG5cclxuICByZXR1cm4gZGlzdGFuY2VGcm9tQm9yZGVyO1xyXG59XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBldnQgPT4ge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbiApIHtcclxuICAgIGlmICggZXZ0LmNvZGUgPT09IHBhaXJbMF0gKSB7XHJcbiAgICAgIHBhaXJbMV0uZm9yRWFjaCgga2JFdmVudCA9PiBrYkV2ZW50KCBldnQgKSApO1xyXG4gICAgfVxyXG4gIH1cclxufSApO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRyYW5zZm9ybUNvb3Jkc0Zyb21FbGVtZW50KCBlbGVtZW50OiBIVE1MRWxlbWVudCApOiBQb2ludDJEIHtcclxuICBjb25zdCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZSA9ICggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGVsZW1lbnQgKS50cmFuc2Zvcm0ubWF0Y2goIHJlZ2V4TnVtYmVyUGF0dGVybiApID8/IFswLCAwXSApLm1hcCggbiA9PiArbiApO1xyXG4gIHJldHVybiB7XHJcbiAgICB4OiBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs0XSAhPT0gdW5kZWZpbmVkID8gTWF0aC5yb3VuZCggYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGVbNF0gKSA6IDAsXHJcbiAgICB5OiBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs1XSAhPT0gdW5kZWZpbmVkID8gTWF0aC5yb3VuZCggYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGVbNV0gKSA6IDBcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGlja0V2ZW50VG9Db29yZGluYXRlcyggZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50ICkge1xyXG4gIGlmICggZXZlbnQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50ICkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogZXZlbnQuY2xpZW50WCxcclxuICAgICAgeTogZXZlbnQuY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2UgaWYgKCBldmVudCBpbnN0YW5jZW9mIFRvdWNoRXZlbnQgKSB7XHJcbiAgICBjb25zdCB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdG91Y2guY2xpZW50WCxcclxuICAgICAgeTogdG91Y2guY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgdGhyb3cgXCJFdmVudCBub3QgRm91bmRcIjtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoaWRlRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICBlbGVtZW50LnN0eWxlLnpJbmRleCA9ICctMSc7XHJcbiAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xyXG4gIGVsZW1lbnQuc3R5bGUud2lkdGggPSAnMHB4ICFpbXBvcnRhbnQnO1xyXG4gIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzBweCAhaW1wb3J0YW50JztcclxuICBlbGVtZW50LnNldEF0dHJpYnV0ZSggJ2hpZGRlbicsICcnICk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzbGVlcEFzeW5jKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPiggKCByZXNvbHZlICkgPT4gc2V0VGltZW91dCggKCkgPT4gcmVzb2x2ZSgpLCBtcyApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiaW5kRWxlbWVudHNCeUNoZWNrKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsIG9uQ2hlY2s6IEZ1bmN0aW9uLCBvblVuY2hlY2s6IEZ1bmN0aW9uICkge1xyXG4gIGlmICggdHJpZ2dlckVsZW1lbnQuY2hlY2tlZCApIHtcclxuICAgIG9uQ2hlY2soIHRhcmdldEVsZW1lbnQgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRyaWdnZXJHcm91cCA9IHRyaWdnZXJFbGVtZW50Lm5hbWVcclxuICAgID8gQXJyYXkuZnJvbSggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggYFtuYW1lPVwiJHsgdHJpZ2dlckVsZW1lbnQubmFtZSB9XCJdYCApIClcclxuICAgIDogW3RyaWdnZXJFbGVtZW50XTtcclxuXHJcbiAgdHJpZ2dlckdyb3VwLmZvckVhY2goIHQgPT4gdC5hZGRFdmVudExpc3RlbmVyKCAnY2hhbmdlJywgZXZ0ID0+IHtcclxuICAgIGlmICggdHJpZ2dlckVsZW1lbnQuY2hlY2tlZCApIHtcclxuICAgICAgb25DaGVjayggdGFyZ2V0RWxlbWVudCwgZXZ0ICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBvblVuY2hlY2soIHRhcmdldEVsZW1lbnQsIGV2dCApO1xyXG4gICAgfVxyXG4gIH0gKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNNb2JpbGVCcm93c2VyKCkge1xyXG4gIHJldHVybiAvQW5kcm9pZHxpUGhvbmUvaS50ZXN0KCBuYXZpZ2F0b3IudXNlckFnZW50ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc09uU2NyZWVuKCBlbGVtZW50OiBIVE1MRWxlbWVudCApIHtcclxuICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICByZXR1cm4gKFxyXG4gICAgcmVjdC50b3AgPj0gMCAmJlxyXG4gICAgcmVjdC5sZWZ0ID49IDAgJiZcclxuICAgIHJlY3QuYm90dG9tIDw9ICggd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgKSAmJlxyXG4gICAgcmVjdC5yaWdodCA8PSAoIHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCApXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJpbmRFbGVtZW50Vmlld0lmQ2hlY2tlZCggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIG9wdGlvbnMgPSB7XHJcbiAgb25DaGVjazogKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQgKSA9PiB7IH0sXHJcbiAgb25VbmNoZWNrOiAoIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCApID0+IHsgfVxyXG59ICkge1xyXG4gIGJpbmRFbGVtZW50c0J5Q2hlY2soXHJcbiAgICB0cmlnZ2VyRWxlbWVudCxcclxuICAgIHRhcmdldEVsZW1lbnQsXHJcbiAgICAoIGVsOiBIVE1MRWxlbWVudCApID0+IHtcclxuICAgICAgZWwuY2xhc3NMaXN0LmFkZCggJ3Nob3cnICk7XHJcbiAgICAgIG9wdGlvbnMub25DaGVjayggdHJpZ2dlckVsZW1lbnQsIHRhcmdldEVsZW1lbnQgKTtcclxuICAgIH0sXHJcbiAgICAoIGVsOiBIVE1MRWxlbWVudCApID0+IHtcclxuICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSggJ3Nob3cnICk7XHJcbiAgICAgIG9wdGlvbnMub25VbmNoZWNrKCB0cmlnZ2VyRWxlbWVudCwgdGFyZ2V0RWxlbWVudCApO1xyXG4gICAgfSxcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmFsdWVGcm9tUmFkaW9Hcm91cCggZ3JvdXBOYW1lOiBzdHJpbmcgKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIGBbbmFtZT0keyBncm91cE5hbWUgfV06Y2hlY2tlZGAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gIGlmICggZWwgKSB7XHJcbiAgICByZXR1cm4gZWwudmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuLy8gUmV0b3JuYSB1bWEgZnVuw6fDo28gcXVlIG7Do28gdmFpIHNlciBjb21wbGV0YWRhIGNhc28gc2VqYSBjaGFtYWRhIG5vdmFtZW50ZSBlbSB7IGRlbGF5IH0gbWlsaXNzZWd1bmRvc1xyXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2VGYWN0b3J5KCBmdW5jOiBGdW5jdGlvbiwgZGVsYXk6IG51bWJlciApOiBGdW5jdGlvbiB7XHJcbiAgbGV0IGluRGVib3VuY2U6IG51bWJlcjtcclxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdpbmRvdztcclxuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBjbGVhclRpbWVvdXQoIGluRGVib3VuY2UgKTtcclxuICAgIGluRGVib3VuY2UgPSB3aW5kb3cuc2V0VGltZW91dCggKCkgPT4gZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApLCBkZWxheSApO1xyXG4gIH07XHJcbn1cclxuXHJcbi8vIFJldG9ybmEgdW1hIGZ1bsOnw6NvIHF1ZSBzw7MgcG9kZSBzZXIgY29tcGxldGFkYSB1bWEgdmV6IGEgY2FkYSB7IGxpbWl0IH0gbWlsaXNzZWd1bmRvcyBcclxuZXhwb3J0IGZ1bmN0aW9uIHRocm90dGxlRmFjdG9yeSggZnVuYzogRnVuY3Rpb24sIGxpbWl0OiBudW1iZXIgKTogRnVuY3Rpb24ge1xyXG4gIGxldCBsYXN0RnVuYzogbnVtYmVyO1xyXG4gIGxldCBsYXN0UmFuOiBudW1iZXI7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB3aW5kb3c7XHJcbiAgICBjb25zdCBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgaWYgKCAhbGFzdFJhbiApIHtcclxuICAgICAgZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApO1xyXG4gICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCggbGFzdEZ1bmMgKTtcclxuICAgICAgbGFzdEZ1bmMgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICggRGF0ZS5ub3coKSAtIGxhc3RSYW4gPj0gbGltaXQgKSB7XHJcbiAgICAgICAgICBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICk7XHJcbiAgICAgICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGxpbWl0IC0gKCBEYXRlLm5vdygpIC0gbGFzdFJhbiApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoU2Nyb2xsVG8oIHBvczogbnVtYmVyICk6IHZvaWQge1xyXG4gIHdpbmRvdy5zY3JvbGxUbygge1xyXG4gICAgdG9wOiBwb3MsXHJcbiAgICBiZWhhdmlvcjogJ3Ntb290aCcsXHJcbiAgfSApO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdE9wdGlvbkJ5VGV4dCggaWRTZWxlY3RFbGVtZW50OiBzdHJpbmcsIHNlYXJjaFRleHQ6IHN0cmluZywgY29udGFpbnM6IGJvb2xlYW4gPSBmYWxzZSApOiB2b2lkIHtcclxuICBjb25zdCBzZWxlY3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGlkU2VsZWN0RWxlbWVudCApIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xyXG5cclxuICBpZiAoICFzZWxlY3RFbGVtZW50ICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb3B0aW9uc0VsZW1lbnRvU2VsZWN0ID0gWy4uLnNlbGVjdEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCggJ29wdGlvbicgKV07XHJcblxyXG4gIGxldCBzZWxlY3RlZE9wdGlvbjtcclxuICBpZiAoIGNvbnRhaW5zICkge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyggc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpICkgKVswXS52YWx1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKSA9PT0gc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpIClbMF0udmFsdWU7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RFbGVtZW50LnZhbHVlID0gc2VsZWN0ZWRPcHRpb247XHJcbn1cclxuXHJcbiIsImltcG9ydCB7IGNoZWNrRWxlbWVudENvbGxpc2lvbiwgZ2V0Q29sbGlzaW9uRGlyZWN0aW9uLCBnZXREZWZhdWx0QXR0cmlidXRlRm9yVGFyZ2V0LCBnZXREaXN0YW5jZUZyb21Cb3JkZXIgfSBmcm9tICcuL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgQ29sbGlzaW9uVHJpZ2dlck9wdGlvbnMgYXMgQ29sbGlzaW9uVHJpZ2dlciwgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlLCBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZUV4dHJhcywgSUNvbGxpc2lvbkV2ZW50IH0gZnJvbSAnLi90eXBlcyc7XHJcblxyXG5leHBvcnQgY29uc3QgbWFwRWxlbWVudHNDb2xsaWRpbmdCeVRhcmdldHMgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBTZXQ8SFRNTEVsZW1lbnQ+PigpO1xyXG5leHBvcnQgY29uc3QgbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBTZXQ8SFRNTEVsZW1lbnQ+PigpO1xyXG5leHBvcnQgY29uc3QgbWFwRWxlbWVudHNUcmlnZ2VyaW5nRXZlbnRzQnlUYXJnZXQgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBTZXQ8SFRNTEVsZW1lbnQ+PigpO1xyXG5cclxubGV0IGNvbGxpc2lvbkNoZWNrSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0O1xyXG5jb25zdCBjb2xsaXNpb25FdmVudHNCeVNlbGVjdG9ycyA9IG5ldyBNYXA8c3RyaW5nLCBDb2xsaXNpb25UcmlnZ2VyW10+KCk7XHJcblxyXG5cclxuLy8vIHB1c2ggZXZlbnRzIHRvIGEgZGljdGlvbmFyeSBhbmQgaWYgdGhleSBleGlzdCBqdXN0IGFkZCBuZXcgdGFyZ2V0cyB0byB0aGVtXHJcbmV4cG9ydCBmdW5jdGlvbiBpbnNlcnRJbnRvRXZlbnRDaGVja0xpc3QoIGVsZW1lbnRUb0NoZWNrOiBIVE1MRWxlbWVudCwgdGFyZ2V0UXVlcnlTZWxlY3Rvcjogc3RyaW5nLCBjb2xsaXNpb25FdmVudHM6IElDb2xsaXNpb25FdmVudFtdICkge1xyXG4gIGNvbnN0IHJlZkV4aXN0aW5nRXZlbnQ6IENvbGxpc2lvblRyaWdnZXJbXSB8IHVuZGVmaW5lZCA9IGNvbGxpc2lvbkV2ZW50c0J5U2VsZWN0b3JzLmdldCggdGFyZ2V0UXVlcnlTZWxlY3RvciApO1xyXG4gIGlmICggcmVmRXhpc3RpbmdFdmVudCApIHtcclxuICAgIHJlZkV4aXN0aW5nRXZlbnQucHVzaCgge1xyXG4gICAgICB0cmlnZ2VyRWxlbWVudDogZWxlbWVudFRvQ2hlY2ssXHJcbiAgICAgIGV2ZW50czogY29sbGlzaW9uRXZlbnRzXHJcbiAgICB9ICk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbGxpc2lvbkV2ZW50c0J5U2VsZWN0b3JzLnNldCggdGFyZ2V0UXVlcnlTZWxlY3RvciwgW3tcclxuICAgICAgdHJpZ2dlckVsZW1lbnQ6IGVsZW1lbnRUb0NoZWNrLFxyXG4gICAgICBldmVudHM6IGNvbGxpc2lvbkV2ZW50c1xyXG4gICAgfV0gKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhbk5vdENvbGxpZGluZ0VsZW1lbnRzQXR0cmlidXRlc0FuZENsYXNzZXMoIHRyaWdnZXJFbGVtZW50c0NvbGxpc2lvbjogU2V0PEhUTUxFbGVtZW50PiwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgdGFyZ2V0Q29sbGlzaW9uOiBTZXQ8SFRNTEVsZW1lbnQ+LCBhZ2VudDogQ29sbGlzaW9uVHJpZ2dlciApIHtcclxuICBpZiAoIHRyaWdnZXJFbGVtZW50c0NvbGxpc2lvbi5kZWxldGUoIHRhcmdldCBhcyBIVE1MRWxlbWVudCApICYmIHRyaWdnZXJFbGVtZW50c0NvbGxpc2lvbi5zaXplID09PSAwICkge1xyXG4gICAgYWdlbnQudHJpZ2dlckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ2NvbGxpZGluZycgKTtcclxuICB9XHJcblxyXG4gIGlmICggdGFyZ2V0Q29sbGlzaW9uLmRlbGV0ZSggYWdlbnQudHJpZ2dlckVsZW1lbnQgKSAmJiB0YXJnZXRDb2xsaXNpb24uc2l6ZSA9PT0gMCApIHtcclxuICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCAnY29sbGlkaW5nJyApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldENvbGxpc2lvbkNsYXNzZXMoIGNvbGxpc2lvblRyaWdnZXI6IENvbGxpc2lvblRyaWdnZXIsIHRhcmdldDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgY29sbGlzaW9uVHJpZ2dlci50cmlnZ2VyRWxlbWVudC5jbGFzc0xpc3QuYWRkKCAnY29sbGlkaW5nJyApO1xyXG4gIHRhcmdldC5jbGFzc0xpc3QuYWRkKCAnY29sbGlkaW5nJyApO1xyXG59XHJcblxyXG5cclxuYXN5bmMgZnVuY3Rpb24gdHJpZ2dlckNvbGxpc2lvbkV2ZW50c0FzeW5jKCBjb2xsaXNpb25UcmlnZ2VyOiBDb2xsaXNpb25UcmlnZ2VyLCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkge1xyXG4gIGNvbnN0IGNvbGxpZGluZ0F0ID0gZ2V0Q29sbGlzaW9uRGlyZWN0aW9uKCBjb2xsaXNpb25UcmlnZ2VyLnRyaWdnZXJFbGVtZW50LCB0YXJnZXQgKTtcclxuICBjb25zdCBkaXN0YW5jZUZyb21Cb3JkZXIgPSBnZXREaXN0YW5jZUZyb21Cb3JkZXIoIGNvbGxpc2lvblRyaWdnZXIudHJpZ2dlckVsZW1lbnQsIHRhcmdldCApO1xyXG4gIGF3YWl0IFByb21pc2UuYWxsKCBjb2xsaXNpb25UcmlnZ2VyLmV2ZW50cy5tYXAoIGFzeW5jIGV2ZW50ID0+IHtcclxuICAgIGF3YWl0IGV2ZW50Lm9uQ29sbGlkaW5nKFxyXG4gICAgICBjb2xsaXNpb25UcmlnZ2VyLnRyaWdnZXJFbGVtZW50LFxyXG4gICAgICB0YXJnZXQsXHJcbiAgICAgIGNvbGxpZGluZ0F0LFxyXG4gICAgICBkaXN0YW5jZUZyb21Cb3JkZXJcclxuICAgICk7XHJcbiAgfSApICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFRhcmdldENsYXNzZXNGb3JFdmVudHMoIGNvbGxpc2lvblRyaWdnZXJzOiBDb2xsaXNpb25UcmlnZ2VyW10sIGNvbGxpc2lvblRhcmdldFNlbGVjdG9yczogc3RyaW5nICk6IHZvaWQge1xyXG4gIGNvbnN0IGFyclRhcmdldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBjb2xsaXNpb25UYXJnZXRTZWxlY3RvcnMgKVxyXG5cclxuICBhcnJUYXJnZXRzLmZvckVhY2goIHRhcmdldCA9PiB7XHJcbiAgICBjb2xsaXNpb25UcmlnZ2Vycy5mb3JFYWNoKCBhZ2VudCA9PiB7XHJcbiAgICAgIGFnZW50LmV2ZW50cy5mb3JFYWNoKCAoIGUgKSA9PiB7XHJcbiAgICAgICAgaWYgKCBlLmF1dG9JbnNlcnRUYXJnZXRDbGFzcyApIHtcclxuICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCBlLnRhcmdldENsYXNzICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IClcclxuICAgIH0gKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFNldE9mRWxlbWVudHNDb2xsaWRpbmdXaXRoVGFyZ2V0cyggdGFyZ2V0OiBIVE1MRWxlbWVudCApOiBTZXQ8SFRNTEVsZW1lbnQ+IHtcclxuICBpZiAoICFtYXBFbGVtZW50c0NvbGxpZGluZ0J5VGFyZ2V0cy5oYXMoIHRhcmdldCApICkge1xyXG4gICAgbWFwRWxlbWVudHNDb2xsaWRpbmdCeVRhcmdldHMuc2V0KCB0YXJnZXQsIG5ldyBTZXQ8SFRNTEVsZW1lbnQ+KCkgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBtYXBFbGVtZW50c0NvbGxpZGluZ0J5VGFyZ2V0cy5nZXQoIHRhcmdldCApITtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U2V0T2ZFbGVtZW50c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQoIHRyaWdnZXJFbGVtZW50OiBIVE1MRWxlbWVudCApOiBTZXQ8SFRNTEVsZW1lbnQ+IHtcclxuICBpZiAoICFtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudC5oYXMoIHRyaWdnZXJFbGVtZW50ICkgKSB7XHJcbiAgICBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudC5zZXQoIHRyaWdnZXJFbGVtZW50LCBuZXcgU2V0PEhUTUxFbGVtZW50PigpICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQuZ2V0KCB0cmlnZ2VyRWxlbWVudCApITtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Q29sbGlzaW9uQ2hlY2soKSB7XHJcbiAgY29sbGlzaW9uRXZlbnRzQnlTZWxlY3RvcnMuZm9yRWFjaCggKCBjb2xsaXNpb25UcmlnZ2VycywgY29sbGlzaW9uVGFyZ2V0U2VsZWN0b3JzICkgPT4ge1xyXG4gICAgc2V0VGFyZ2V0Q2xhc3Nlc0ZvckV2ZW50cyggY29sbGlzaW9uVHJpZ2dlcnMsIGNvbGxpc2lvblRhcmdldFNlbGVjdG9ycyApO1xyXG4gIH0gKTtcclxuXHJcbiAgY29sbGlzaW9uQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKCAoKSA9PiB7XHJcbiAgICBjb2xsaXNpb25FdmVudHNCeVNlbGVjdG9ycy5mb3JFYWNoKCBhc3luYyAoIGNvbGxpc2lvblRyaWdnZXJzLCBjb2xsaXNpb25UYXJnZXRTZWxlY3RvcnMgKSA9PiB7XHJcbiAgICAgIGNvbnN0IGFyclRhcmdldHMgPSBBcnJheS5mcm9tKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBjb2xsaXNpb25UYXJnZXRTZWxlY3RvcnMgKSApIGFzIEhUTUxFbGVtZW50W107XHJcblxyXG4gICAgICBzZXRDb2xsaXNpb25FdmVudHNGb3JUYXJnZXRzKCBhcnJUYXJnZXRzLCBjb2xsaXNpb25UcmlnZ2VycyApO1xyXG4gICAgfSApO1xyXG4gIH0sIDUwICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldENvbGxpc2lvbkV2ZW50c0ZvclRhcmdldHMoIGFyclRhcmdldHM6IEhUTUxFbGVtZW50W10sIGNvbGxpc2lvblRyaWdnZXJzOiBDb2xsaXNpb25UcmlnZ2VyW10gKSB7XHJcbiAgYXJyVGFyZ2V0cy5mb3JFYWNoKCBhc3luYyB0YXJnZXQgPT4ge1xyXG4gICAgY29uc3QgdGFyZ2V0Q29sbGlzaW9uU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+ID0gZ2V0U2V0T2ZFbGVtZW50c0NvbGxpZGluZ1dpdGhUYXJnZXRzKCB0YXJnZXQgKTtcclxuXHJcbiAgICBjb2xsaXNpb25UcmlnZ2Vycy5mb3JFYWNoKCBhc3luYyB0cmlnZ2VyID0+IHtcclxuICAgICAgaWYgKCB0cmlnZ2VyLnRyaWdnZXJFbGVtZW50ID09PSB0YXJnZXQgKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0cmlnZ2VyQ29sbGlzaW9uU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+ID0gZ2V0U2V0T2ZFbGVtZW50c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQoIHRyaWdnZXIudHJpZ2dlckVsZW1lbnQgKTtcclxuXHJcbiAgICAgIGNvbnN0IGlzQ29sbGlzaW9uOiBib29sZWFuID0gY2hlY2tFbGVtZW50Q29sbGlzaW9uKCB0cmlnZ2VyLnRyaWdnZXJFbGVtZW50LCB0YXJnZXQgKTtcclxuXHJcbiAgICAgIGlmICggIWlzQ29sbGlzaW9uICkge1xyXG4gICAgICAgIGF3YWl0IG9uRWxlbWVudHNOb3RDb2xsaWRpbmcoIHRyaWdnZXJDb2xsaXNpb25TZXQsIHRhcmdldCwgdGFyZ2V0Q29sbGlzaW9uU2V0LCB0cmlnZ2VyICk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0cmlnZ2VyQ29sbGlzaW9uU2V0LmFkZCggdGFyZ2V0ICk7XHJcbiAgICAgIHRhcmdldENvbGxpc2lvblNldC5hZGQoIHRyaWdnZXIudHJpZ2dlckVsZW1lbnQgKTtcclxuXHJcbiAgICAgIHNldENvbGxpc2lvbkNsYXNzZXMoIHRyaWdnZXIsIHRhcmdldCApO1xyXG5cclxuICAgICAgYXdhaXQgdHJpZ2dlckNvbGxpc2lvbkV2ZW50c0FzeW5jKCB0cmlnZ2VyLCB0YXJnZXQgKTtcclxuICAgIH0gKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIG9uRWxlbWVudHNOb3RDb2xsaWRpbmcoIHRyaWdnZXJDb2xsaXNpb25TZXQ6IFNldDxIVE1MRWxlbWVudD4sIHRhcmdldDogSFRNTEVsZW1lbnQsIHRhcmdldENvbGxpc2lvblNldDogU2V0PEhUTUxFbGVtZW50PiwgdHJpZ2dlcjogQ29sbGlzaW9uVHJpZ2dlciApIHtcclxuICBjbGVhbk5vdENvbGxpZGluZ0VsZW1lbnRzQXR0cmlidXRlc0FuZENsYXNzZXMoXHJcbiAgICB0cmlnZ2VyQ29sbGlzaW9uU2V0LFxyXG4gICAgdGFyZ2V0LFxyXG4gICAgdGFyZ2V0Q29sbGlzaW9uU2V0LFxyXG4gICAgdHJpZ2dlclxyXG4gICk7XHJcblxyXG4gIGF3YWl0IFByb21pc2UuYWxsKCB0cmlnZ2VyLmV2ZW50cy5tYXAoIGFzeW5jIGV2ZW50ID0+IHtcclxuICAgIGF3YWl0IGV2ZW50Lm9uTm90Q29sbGlkaW5nKFxyXG4gICAgICB0cmlnZ2VyLnRyaWdnZXJFbGVtZW50LFxyXG4gICAgICB0YXJnZXRcclxuICAgICk7XHJcbiAgfSApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0Q29sbGlzaW9uQ2hlY2tPbiggZWxlbWVudFRvQ2hlY2s6IEhUTUxFbGVtZW50LCB0YXJnZXRRdWVyeVNlbGVjdG9yOiBzdHJpbmcsIGNvbGxpc2lvbkV2ZW50czogSUNvbGxpc2lvbkV2ZW50W10gKTogdm9pZCB7XHJcbiAgaW5zZXJ0SW50b0V2ZW50Q2hlY2tMaXN0KCBlbGVtZW50VG9DaGVjaywgdGFyZ2V0UXVlcnlTZWxlY3RvciwgY29sbGlzaW9uRXZlbnRzICk7XHJcblxyXG4gIGlmICggY29sbGlzaW9uQ2hlY2tJbnRlcnZhbCApIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHNldENvbGxpc2lvbkNoZWNrKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkVGFyZ2V0VG9UcmlnZ2VyRXZlbnQoIGN1cnJlbnRUYXJnZXQ6IEhUTUxFbGVtZW50LCB0YXJnZXRDbGFzc05hbWU6IHN0cmluZywgdmFsaWRhdGVEaXN0YW5jZT86IHsgZGlzdGFuY2VUaHJlc2hvbGQ6IG51bWJlciwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSB9ICk6IGJvb2xlYW4ge1xyXG4gIGlmICggIWN1cnJlbnRUYXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCB0YXJnZXRDbGFzc05hbWUgKSApIHtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGlmICggdmFsaWRhdGVEaXN0YW5jZSApIHtcclxuICAgIC8vLyBDaGVja3MgaG93IG1hbnkgcGl4ZWxzIHRoZSBkcmFnZ2FibGUgaXMgaW5zaWRlIGZyb20gZWFjaCBib3JkZXI7IGlmIHRoZSBlbGVtZW50IGlzIG92ZXIgdGhlIHRocmVzaG9sZCB0aGUgZnVuY3Rpb24gd2lsbCByZXR1cm4gdHJ1ZTtcclxuICAgIGNvbnN0IGNvbGxpc2lvbkJvcmRlckRpc3RhbmNlRXh0cmFzID0gbmV3IENvbGxpc2lvbkJvcmRlckRpc3RhbmNlRXh0cmFzKCB2YWxpZGF0ZURpc3RhbmNlLmRpc3RhbmNlRnJvbUJvcmRlciApO1xyXG4gICAgaWYgKCBjb2xsaXNpb25Cb3JkZXJEaXN0YW5jZUV4dHJhcy5hbnlMb3dlclRoYW4oIHZhbGlkYXRlRGlzdGFuY2UuZGlzdGFuY2VUaHJlc2hvbGQgKSApIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50c0ludGVyYWN0aW5nU2V0KCB0YXJnZXQ6IEhUTUxFbGVtZW50ICk6IFNldDxIVE1MRWxlbWVudD4ge1xyXG4gIGlmICggIW1hcEVsZW1lbnRzVHJpZ2dlcmluZ0V2ZW50c0J5VGFyZ2V0LmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBFbGVtZW50c1RyaWdnZXJpbmdFdmVudHNCeVRhcmdldC5zZXQoIHRhcmdldCwgbmV3IFNldDxIVE1MRWxlbWVudD4oKSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG1hcEVsZW1lbnRzVHJpZ2dlcmluZ0V2ZW50c0J5VGFyZ2V0LmdldCggdGFyZ2V0ICkhO1xyXG59XHJcbiIsImV4cG9ydCBjb25zdCByZWdleE51bWJlclBhdHRlcm4gPSAvLT9cXGQrXFwuP1xcZCovZztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUG9pbnQyRCB7XHJcbiAgeDogbnVtYmVyO1xyXG4gIHk6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBEaW1lbnNpb25zIHtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5kZXhUb1JvdyggaW5kZXg6IG51bWJlciwgZ3JpZFdpZHRoOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIE1hdGguZmxvb3IoIGluZGV4IC8gZ3JpZFdpZHRoICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbmRleFRvQ29sKCBpbmRleDogbnVtYmVyLCBncmlkV2lkdGg6IG51bWJlciApIHtcclxuICByZXR1cm4gaW5kZXggJSBncmlkV2lkdGg7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByb3dDb2xUb0luZGV4KCByb3c6IG51bWJlciwgY29sOiBudW1iZXIsIHdpZHRoOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuICggcm93ICogd2lkdGggKSArIGNvbDtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsZXJwKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIsIGFtb3VudDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgcmV0dXJuICggMSAtIGFtb3VudCApICogbWluICsgYW1vdW50ICogbWF4O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW52ZXJzZUxlcnAoIGE6IG51bWJlciwgYjogbnVtYmVyLCB2YWw6IG51bWJlciApOiBudW1iZXIge1xyXG4gIHJldHVybiAoIHZhbCAtIGEgKSAvICggYiAtIGEgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlbWFwKCBpbk1pbjogbnVtYmVyLCBpbk1heDogbnVtYmVyLCBvdXRNaW46IG51bWJlciwgb3V0TWF4OiBudW1iZXIsIHZhbDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgcmV0dXJuIGxlcnAoIG91dE1pbiwgb3V0TWF4LCBpbnZlcnNlTGVycCggaW5NaW4sIGluTWF4LCB2YWwgKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmFuZG9tSW50RXhjbHVzaXZlKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIE1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiAoIG1heCAtIG1pbiApICsgbWluICk7XHJcbn1cclxuXHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJhbmRvbUludEluY2x1c2l2ZSggbWluOiBudW1iZXIsIG1heDogbnVtYmVyICkge1xyXG4gIG1pbiA9IE1hdGguY2VpbCggbWluICk7XHJcbiAgbWF4ID0gTWF0aC5mbG9vciggbWF4ICk7XHJcbiAgcmV0dXJuIE1hdGguZmxvb3IoIE1hdGgucmFuZG9tKCkgKiAoIG1heCAtIG1pbiArIDEgKSApICsgbWluO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmFuZG9tRnJvbUFycmF5PFQ+KCBhcnI6IEFycmF5PFQ+ICkge1xyXG4gIHJldHVybiBhcnJbZ2V0UmFuZG9tSW50RXhjbHVzaXZlKCAwLCBhcnIubGVuZ3RoICldO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xhbXAoIG51bTogbnVtYmVyID0gMCwgbWluOiBudW1iZXIgPSAwLCBtYXg6IG51bWJlciA9IDEwMCApOiBudW1iZXIge1xyXG4gIHJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbnVtLCBtYXggKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWludXRlc1RvTWlsbGlzZWNvbmRzKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBtcyAqIDYwMDAwO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWlsbGlzZWNvbmRzVG9NaW51dGVzKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBtcyAvIDYwMDAwO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWlsbGlzZWNvbmRzVG9Ib3VycyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gbXMgLyAzLjZlKzY7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaWxsaXNlY29uZHNUb0RheXMoIG1zOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG1zIC8gOC42NGUrNztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1lZ2FieXRlVG9CeXRlKCBtYjogbnVtYmVyICkge1xyXG4gIHJldHVybiBtYiAqIDEwMjQgKiAxMDI0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYnl0ZVRvTWVnYWJ5dGUoIGI6IG51bWJlciApIHtcclxuICByZXR1cm4gYiAvIDEwMjQgLyAxMDI0O1xyXG59IiwiaW1wb3J0IHsgZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQgfSBmcm9tICcuL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgZ2V0RWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQsIGlzVmFsaWRUYXJnZXRUb1RyaWdnZXJFdmVudCB9IGZyb20gJy4vRHJhZ2dhYmxlQWN0aW9uJztcclxuaW1wb3J0IHsgUG9pbnQyRCB9IGZyb20gJy4vTWF0aFRvb2xzJztcclxuaW1wb3J0IHsgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlLCBJQ29sbGlzaW9uRXZlbnQgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCB0eXBlIFBpblBvc2l0aW9uRm9ybXVsYSA9ICggKCBkcmFnZ2FibGVSZWN0OiBET01SZWN0LCB0YXJnZXRSZWN0OiBET01SZWN0LCBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbjogUG9pbnQyRCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApID0+IFBvaW50MkQgKVxyXG5cclxuZXhwb3J0IHR5cGUgT25QaW5FdmVudCA9ICggKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkgPT4gdm9pZCApXHJcblxyXG5leHBvcnQgY2xhc3MgUGluQ29sbGlzaW9uRXZlbnQgaW1wbGVtZW50cyBJQ29sbGlzaW9uRXZlbnQge1xyXG4gIHByaXZhdGUgb25QaW4/OiBPblBpbkV2ZW50O1xyXG4gIHByaXZhdGUgb25VbnBpbj86IE9uUGluRXZlbnQ7XHJcbiAgcHJpdmF0ZSBwaW5Qb3NpdGlvbkZvcm11bGE/OiBQaW5Qb3NpdGlvbkZvcm11bGE7XHJcblxyXG4gIHB1YmxpYyB0YXJnZXRDbGFzczogc3RyaW5nID0gJ3Bpbi10YXJnZXQnO1xyXG4gIHB1YmxpYyBhdXRvSW5zZXJ0VGFyZ2V0Q2xhc3M6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICBjb25zdHJ1Y3RvciggeyBwaW5Qb3NpdGlvbkZvcm11bGEsIG9uUGluLCBvblVucGluIH06IHsgcGluUG9zaXRpb25Gb3JtdWxhPzogUGluUG9zaXRpb25Gb3JtdWxhLCBvblBpbj86IE9uUGluRXZlbnQsIG9uVW5waW4/OiBPblBpbkV2ZW50IH0gKSB7XHJcbiAgICB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSA9IHBpblBvc2l0aW9uRm9ybXVsYSB8fCB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLm9uUGluID0gb25QaW4gfHwgdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5vblVucGluID0gb25VbnBpbiB8fCB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgb25Db2xsaWRpbmcoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIF9jb2xsaWRpbmdBdDogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIGRpc3RhbmNlRnJvbUJvcmRlcjogQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UgKSB7XHJcbiAgICBpZiAoICFpc1ZhbGlkVGFyZ2V0VG9UcmlnZ2VyRXZlbnQoIHRhcmdldCwgdGhpcy50YXJnZXRDbGFzcyApICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZWxlbWVudHNJbnRlcmFjdGluZ1NldDogU2V0PEhUTUxFbGVtZW50PiA9IGdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQoIHRhcmdldCApO1xyXG4gICAgY29uc3QgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSA9ICd0b3RhbC1waW5uZWQtZWxlbWVudHMnO1xyXG4gICAgaWYgKCBkcmFnZ2FibGUuY2xhc3NMaXN0LmNvbnRhaW5zKCAnZHJhZ2dpbmcnICkgKSB7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QucmVtb3ZlKCAncGlubmVkJyApO1xyXG4gICAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LmFkZCggJ3JlYWR5LXRvLXBpbicgKTtcclxuXHJcbiAgICAgIGlmICggZWxlbWVudHNJbnRlcmFjdGluZ1NldC5kZWxldGUoIGRyYWdnYWJsZSApICkge1xyXG4gICAgICAgIHRoaXMub25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UoIHRhcmdldCwgZWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSApO1xyXG4gICAgICAgIHRoaXMub25VbnBpbiA/IHRoaXMub25VbnBpbiggZHJhZ2dhYmxlLCB0YXJnZXQgKSA6IHt9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSApIHtcclxuICAgICAgcGluRHJhZ2dhYmxlQnlGb3JtdWxhKCBkcmFnZ2FibGUsIHRhcmdldCwgZGlzdGFuY2VGcm9tQm9yZGVyLCB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGluRHJhZ2dhYmxlT25DZW50ZXIoIGRyYWdnYWJsZSwgdGFyZ2V0LCBkaXN0YW5jZUZyb21Cb3JkZXIgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoICFlbGVtZW50c0ludGVyYWN0aW5nU2V0LmhhcyggZHJhZ2dhYmxlICkgKSB7XHJcbiAgICAgIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuYWRkKCBkcmFnZ2FibGUgKTtcclxuICAgICAgdGhpcy5vblBpbiA/IHRoaXMub25QaW4oIGRyYWdnYWJsZSwgdGFyZ2V0ICkgOiB7fTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZHJhZ2dhYmxlLmNsYXNzTGlzdC5hZGQoICdwaW5uZWQnICk7XHJcbiAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LnJlbW92ZSggJ3JlYWR5LXRvLXBpbicgKTtcclxuICAgIHRoaXMub25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UoIHRhcmdldCwgZWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG9uTm90Q29sbGlkaW5nKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkge1xyXG4gICAgY29uc3QgZWxlbWVudHNJbnRlcmFjdGluZ1NldDogU2V0PEhUTUxFbGVtZW50PiA9IGdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQoIHRhcmdldCApO1xyXG4gICAgZWxlbWVudHNJbnRlcmFjdGluZ1NldC5kZWxldGUoIGRyYWdnYWJsZSApO1xyXG5cclxuICAgIGlmICggZWxlbWVudHNJbnRlcmFjdGluZ1NldC5zaXplID4gMCApIHtcclxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoICdoYXMtcGlubmVkLWVsZW1lbnRzJyApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoICdoYXMtcGlubmVkLWVsZW1lbnRzJyApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggIW1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LmhhcyggZHJhZ2dhYmxlICkgKSB7XHJcbiAgICAgIG1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LnNldCggZHJhZ2dhYmxlLCBuZXcgU2V0PEhUTUxFbGVtZW50PigpICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWdlbnRDb2xsaXNpb25TZXQgPSBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudC5nZXQoIGRyYWdnYWJsZSApITtcclxuICAgIGlmICggYWdlbnRDb2xsaXNpb25TZXQuZGVsZXRlKCB0YXJnZXQgYXMgSFRNTEVsZW1lbnQgKSAmJiBhZ2VudENvbGxpc2lvblNldC5zaXplID09PSAwICkge1xyXG4gICAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LnJlbW92ZSggJ3Bpbm5lZCcsICdyZWFkeS10by1waW4nICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uRWxlbWVudEludGVyYWN0aW9uQ2hhbmdlKCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBlbGVtZW50c0ludGVyYWN0aW5nU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+LCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlOiBzdHJpbmcgKSB7XHJcbiAgICBpZiAoIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuc2l6ZSA+IDAgKSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCAnaGFzLXBpbm5lZC1lbGVtZW50cycgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCAnaGFzLXBpbm5lZC1lbGVtZW50cycgKTtcclxuICAgIH1cclxuXHJcbiAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlLCBlbGVtZW50c0ludGVyYWN0aW5nU2V0LnNpemUudG9TdHJpbmcoKSApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBpbkRyYWdnYWJsZUJ5Rm9ybXVsYSggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSwgcGluUG9zaXRpb25Gb3JtdWxhOiBQaW5Qb3NpdGlvbkZvcm11bGEgKSB7XHJcbiAgY29uc3QgdGFyZ2V0UmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICBjb25zdCBkcmFnZ2FibGVSZWN0ID0gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uID0gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIGRyYWdnYWJsZSApO1xyXG4gIGNvbnN0IHBpblBvc2l0aW9uOiBQb2ludDJEID0gcGluUG9zaXRpb25Gb3JtdWxhKCBkcmFnZ2FibGVSZWN0LCB0YXJnZXRSZWN0LCBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbiwgZGlzdGFuY2VGcm9tQm9yZGVyICk7XHJcbiAgZHJhZ2dhYmxlLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHsgcGluUG9zaXRpb24ueCB9cHgsICR7IHBpblBvc2l0aW9uLnkgfXB4KWA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwaW5EcmFnZ2FibGVPbkNlbnRlciggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApIHtcclxuICBjb25zdCB0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uID0gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIGRyYWdnYWJsZSApO1xyXG4gIGNvbnN0IHRhcmdldFJpZ2h0UG9zaXRpb24gPSBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbi54ICsgZGlzdGFuY2VGcm9tQm9yZGVyLnJpZ2h0O1xyXG4gIGNvbnN0IHRhcmdldEJvdHRvbVBvc2l0aW9uID0gZHJhZ2dhYmxlVHJhbnNmb3JtUG9zaXRpb24ueSArIGRpc3RhbmNlRnJvbUJvcmRlci5ib3R0b207XHJcbiAgZHJhZ2dhYmxlLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHsgTWF0aC5yb3VuZCggdGFyZ2V0UmlnaHRQb3NpdGlvbiAtICggdGFyZ2V0UmVjdC53aWR0aCAvIDIgKSApIH1weCwgJHsgTWF0aC5yb3VuZCggdGFyZ2V0Qm90dG9tUG9zaXRpb24gLSAoIHRhcmdldFJlY3QuaGVpZ2h0IC8gMiApICkgfXB4KWA7XHJcbn1cclxuXHJcbiIsImltcG9ydCB7IGdldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQgfSBmcm9tICcuL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgaXNWYWxpZFRhcmdldFRvVHJpZ2dlckV2ZW50LCBnZXRFbGVtZW50c0ludGVyYWN0aW5nU2V0LCBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudCB9IGZyb20gJy4vRHJhZ2dhYmxlQWN0aW9uJztcclxuaW1wb3J0IHsgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlLCBJQ29sbGlzaW9uRXZlbnQgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCB0eXBlIFNoYXJlQXR0cmlidXRlQ29sbGlzaW9uRXZlbnRPcHRpb25zID0ge1xyXG4gIGtlZXBBdHRyaWJ1dGU/OiBib29sZWFuO1xyXG59XHJcblxyXG5cclxuY29uc3QgZGVmYXVsdFNoYXJlQXR0cmlidXRlQ29sbGlzaW9uRXZlbnRPcHRpb25zID0ge1xyXG4gIGtlZXBBdHRyaWJ1dGU6IGZhbHNlXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTaGFyZUF0dHJpYnV0ZUNvbGxpc2lvbkV2ZW50IGltcGxlbWVudHMgSUNvbGxpc2lvbkV2ZW50IHtcclxuICBrZWVwQXR0cmlidXRlOiBib29sZWFuO1xyXG5cclxuICBwdWJsaWMgdGFyZ2V0Q2xhc3M6IHN0cmluZyA9ICdhdHRyaWJ1dGUtdGFyZ2V0JztcclxuICBwdWJsaWMgYXV0b0luc2VydFRhcmdldENsYXNzOiBib29sZWFuID0gdHJ1ZTtcclxuXHJcbiAgY29uc3RydWN0b3IoIG9wdGlvbnM6IFNoYXJlQXR0cmlidXRlQ29sbGlzaW9uRXZlbnRPcHRpb25zID0gZGVmYXVsdFNoYXJlQXR0cmlidXRlQ29sbGlzaW9uRXZlbnRPcHRpb25zICkge1xyXG4gICAgdGhpcy5rZWVwQXR0cmlidXRlID0gb3B0aW9ucy5rZWVwQXR0cmlidXRlIHx8IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG9uQ29sbGlkaW5nKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBfY29sbGlkaW5nQXQ6IENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrLCBfZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApIHtcclxuICAgIC8vLyBDaGVja3MgaWYgdGhlIGRyYWdnYWJsZSBoYXMgdGhlIGtleSBhdHRyaWJ1dGVzIHRoYXQgcmVwcmVzZW50cyB3aGF0IGF0dHJpYnV0ZSB3aWxsIGJlIGluc2VydGVkIG9uIHRhcmdldFxyXG4gICAgY29uc3Qgc2hhcmVkQXR0cmlidXRlTmFtZSA9IGRyYWdnYWJsZS5nZXRBdHRyaWJ1dGUoICdzaGFyZWQtYXR0cmlidXRlLW5hbWUnICk7XHJcbiAgICBjb25zdCBzaGFyZWRBdHRyaWJ1dGVWYWx1ZSA9IGRyYWdnYWJsZS5nZXRBdHRyaWJ1dGUoICdzaGFyZWQtYXR0cmlidXRlLXZhbHVlJyApO1xyXG4gICAgaWYgKCAhc2hhcmVkQXR0cmlidXRlVmFsdWUgfHwgIXNoYXJlZEF0dHJpYnV0ZU5hbWUgfHwgIWlzVmFsaWRUYXJnZXRUb1RyaWdnZXJFdmVudCggdGFyZ2V0LCB0aGlzLnRhcmdldENsYXNzICkgKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBlbGVtZW50c0ludGVyYWN0aW5nU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+ID0gZ2V0RWxlbWVudHNJbnRlcmFjdGluZ1NldCggdGFyZ2V0ICk7XHJcbiAgICBjb25zdCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlID0gJ3RvdGFsLXNoYXJpbmctYXR0cmlidXRlcyc7XHJcblxyXG4gICAgaWYgKCBkcmFnZ2FibGUuY2xhc3NMaXN0LmNvbnRhaW5zKCAnZHJhZ2dpbmcnICkgKSB7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QucmVtb3ZlKCAnc2hhcmluZy1hdHRyaWJ1dGUnICk7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QuYWRkKCAncmVhZHktdG8tc2hhcmUtYXR0cmlidXRlJyApO1xyXG5cclxuICAgICAgdGhpcy5oYW5kbGVFbGVtZW50SW50ZXJhY3Rpb25TaGFyZUF0dHJpYnV0ZSggZHJhZ2dhYmxlLCB0YXJnZXQsIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQsIG5hbWVDb3VudEVsZW1lbnRzSW50ZXJhY3RpbmdBdHRyaWJ1dGUgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QuYWRkKCAnc2hhcmluZy1hdHRyaWJ1dGUnICk7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QucmVtb3ZlKCAncmVhZHktdG8tc2hhcmUtYXR0cmlidXRlJyApO1xyXG5cclxuICAgICAgdGFyZ2V0LnNldEF0dHJpYnV0ZSggc2hhcmVkQXR0cmlidXRlTmFtZSwgc2hhcmVkQXR0cmlidXRlVmFsdWUgKTtcclxuXHJcbiAgICAgIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuYWRkKCBkcmFnZ2FibGUgKTtcclxuICAgICAgdGhpcy5oYW5kbGVFbGVtZW50SW50ZXJhY3Rpb25TaGFyZUF0dHJpYnV0ZSggZHJhZ2dhYmxlLCB0YXJnZXQsIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQsIG5hbWVDb3VudEVsZW1lbnRzSW50ZXJhY3RpbmdBdHRyaWJ1dGUgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBvbk5vdENvbGxpZGluZyggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCApIHtcclxuICAgIGNvbnN0IGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQ6IFNldDxIVE1MRWxlbWVudD4gPSBnZXRFbGVtZW50c0ludGVyYWN0aW5nU2V0KCB0YXJnZXQgKTtcclxuXHJcbiAgICBpZiAoIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuc2l6ZSA+IDAgKSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCAnc2hhcmluZy1hdHRyaWJ1dGUnICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm9uU2hhcmVkQXR0cmlidXRlRW1wdHkoIGRyYWdnYWJsZSwgdGFyZ2V0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCAhbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQuaGFzKCBkcmFnZ2FibGUgKSApIHtcclxuICAgICAgbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQuc2V0KCBkcmFnZ2FibGUsIG5ldyBTZXQ8SFRNTEVsZW1lbnQ+KCkgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhZ2VudENvbGxpc2lvblNldCA9IG1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LmdldCggZHJhZ2dhYmxlICkhO1xyXG4gICAgaWYgKCBhZ2VudENvbGxpc2lvblNldC5kZWxldGUoIHRhcmdldCBhcyBIVE1MRWxlbWVudCApIHx8IGFnZW50Q29sbGlzaW9uU2V0LnNpemUgPT09IDAgKSB7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QucmVtb3ZlKCAnc2hhcmluZy1hdHRyaWJ1dGUnLCAncmVhZHktdG8tc2hhcmUtYXR0cmlidXRlJyApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGhhbmRsZUVsZW1lbnRJbnRlcmFjdGlvblNoYXJlQXR0cmlidXRlKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBlbGVtZW50c0ludGVyYWN0aW5nU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+LCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlOiBzdHJpbmcgKSB7XHJcbiAgICBpZiAoIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuc2l6ZSA+IDAgKSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCAnc2hhcmluZy1hdHRyaWJ1dGUnICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLm9uU2hhcmVkQXR0cmlidXRlRW1wdHkoIGRyYWdnYWJsZSwgdGFyZ2V0ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGFyZ2V0LnNldEF0dHJpYnV0ZSggbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSwgZWxlbWVudHNJbnRlcmFjdGluZ1NldC5zaXplLnRvU3RyaW5nKCkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBvblNoYXJlZEF0dHJpYnV0ZUVtcHR5KCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkge1xyXG4gICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoICdzaGFyaW5nLWF0dHJpYnV0ZScgKTtcclxuXHJcbiAgICAvLy8gUmV0dXJucyB0aGUgYXR0cmlidXRlIHRvIHRoZSBmaXJzdCBhdHRyaWJ1dGUgdGhhdCB3YXMgc2V0IHRvIHRhcmdldFxyXG4gICAgY29uc3Qgc2hhcmVkQXR0cmlidXRlTmFtZSA9IGRyYWdnYWJsZS5nZXRBdHRyaWJ1dGUoICdzaGFyZWQtYXR0cmlidXRlLW5hbWUnICk7XHJcbiAgICBpZiAoIHNoYXJlZEF0dHJpYnV0ZU5hbWUgKSB7XHJcbiAgICAgIGNvbnN0IGRlZmF1bHRTaGFyZWRBdHRyaWJ1dGVGcm9tVGFyZ2V0ID0gZ2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0LCBzaGFyZWRBdHRyaWJ1dGVOYW1lICk7XHJcbiAgICAgIGlmICggZGVmYXVsdFNoYXJlZEF0dHJpYnV0ZUZyb21UYXJnZXQgKSB7XHJcbiAgICAgICAgdGFyZ2V0LnNldEF0dHJpYnV0ZSggc2hhcmVkQXR0cmlidXRlTmFtZSwgZGVmYXVsdFNoYXJlZEF0dHJpYnV0ZUZyb21UYXJnZXQgKTtcclxuICAgICAgfSBlbHNlIGlmICggIXRoaXMua2VlcEF0dHJpYnV0ZSApIHtcclxuICAgICAgICB0YXJnZXQucmVtb3ZlQXR0cmlidXRlKCBzaGFyZWRBdHRyaWJ1dGVOYW1lICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbiIsImltcG9ydCB7IElQb2ludDJEIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuXHJcbmV4cG9ydCBlbnVtIENPTlZFUlNJT05fVU5JVCB7IFBJWEVMLCBQRVJDRU5UQUdFIH1cclxuZXhwb3J0IGVudW0gRElSRUNUSU9OX1JFRkVSRU5DRSB7IEhPUklaT05UQUwsIFZFUlRJQ0FMIH1cclxuZXhwb3J0IGVudW0gVkVSVElDQUxfUkVGRVJFTkNFIHsgRlJPTV9UT1AsIEZST01fQk9UVE9NIH1cclxuXHJcbmV4cG9ydCBlbnVtIENPTE9SX0NIQU5ORUwgeyBSLCBHLCBCLCBBIH07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENvbXBhcmFibGU8VD4ge1xyXG4gIGVxdWFscyggYjogVCApOiBib29sZWFuO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIENTU1Bvc2l0aW9uIGltcGxlbWVudHMgSVBvaW50MkQge1xyXG4gIHB1YmxpYyB4OiBudW1iZXI7XHJcbiAgcHVibGljIHk6IG51bWJlcjtcclxuICBwcml2YXRlIHR5cGU6IENPTlZFUlNJT05fVU5JVDtcclxuICBwdWJsaWMgdmVydGljYWxSZWZlcmVuY2U6IFZFUlRJQ0FMX1JFRkVSRU5DRTtcclxuXHJcbiAgY29uc3RydWN0b3IoIHsgeCwgeSwgdmVydGljYWxSZWZlcmVuY2UgPSBWRVJUSUNBTF9SRUZFUkVOQ0UuRlJPTV9UT1AsIHR5cGUgPSBDT05WRVJTSU9OX1VOSVQuUElYRUwgfTogeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgdmVydGljYWxSZWZlcmVuY2U/OiBWRVJUSUNBTF9SRUZFUkVOQ0U7IHR5cGU/OiBDT05WRVJTSU9OX1VOSVQ7IH0gKSB7XHJcbiAgICBbdGhpcy54LCB0aGlzLnksIHRoaXMudmVydGljYWxSZWZlcmVuY2UsIHRoaXMudHlwZV0gPSBbeCwgeSwgdmVydGljYWxSZWZlcmVuY2UsIHR5cGVdO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGhvcml6b250YWwoKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoIHRoaXMudHlwZSApIHtcclxuICAgICAgY2FzZSBDT05WRVJTSU9OX1VOSVQuUElYRUw6XHJcbiAgICAgICAgcmV0dXJuIGAkeyB0aGlzLnggfXB4YDtcclxuICAgICAgY2FzZSBDT05WRVJTSU9OX1VOSVQuUEVSQ0VOVEFHRTpcclxuICAgICAgICByZXR1cm4gYCR7IHRoaXMueCB9JWA7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGAkeyB0aGlzLnggfXB4YDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldCB2ZXJ0aWNhbCgpOiBzdHJpbmcge1xyXG4gICAgc3dpdGNoICggdGhpcy50eXBlICkge1xyXG4gICAgICBjYXNlIENPTlZFUlNJT05fVU5JVC5QSVhFTDpcclxuICAgICAgICByZXR1cm4gYCR7IHRoaXMueSB9cHhgO1xyXG4gICAgICBjYXNlIENPTlZFUlNJT05fVU5JVC5QRVJDRU5UQUdFOlxyXG4gICAgICAgIHJldHVybiBgJHsgdGhpcy55IH0lYDtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gYCR7IHRoaXMueSB9cHhgO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2sgPSB7XHJcbiAgdG9wOiBib29sZWFuO1xyXG4gIHJpZ2h0OiBib29sZWFuO1xyXG4gIGNlbnRlcjogYm9vbGVhbjtcclxuICBib3R0b206IGJvb2xlYW47XHJcbiAgbGVmdDogYm9vbGVhbjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlID0ge1xyXG4gIHRvcDogbnVtYmVyO1xyXG4gIHJpZ2h0OiBudW1iZXI7XHJcbiAgYm90dG9tOiBudW1iZXI7XHJcbiAgbGVmdDogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElDb2xsaXNpb25FdmVudCB7XHJcbiAgdGFyZ2V0Q2xhc3M6IHN0cmluZztcclxuICBhdXRvSW5zZXJ0VGFyZ2V0Q2xhc3M6IGJvb2xlYW47XHJcbiAgb25Db2xsaWRpbmcoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIGNvbGxpZGluZ0F0OiBDb2xsaXNpb25EaXJlY3Rpb25DaGVjaywgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApOiBQcm9taXNlPHZvaWQ+O1xyXG4gIG9uTm90Q29sbGlkaW5nKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICk6IFByb21pc2U8dm9pZD47XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENvbGxpc2lvblRyaWdnZXJPcHRpb25zID0ge1xyXG4gIHRyaWdnZXJFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuICBldmVudHM6IElDb2xsaXNpb25FdmVudFtdO1xyXG59O1xyXG5cclxuZXhwb3J0IGNsYXNzIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlRXh0cmFzIHtcclxuICBjb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXM6IENvbGxpc2lvbkJvcmRlckRpc3RhbmNlO1xyXG5cclxuICBjb25zdHJ1Y3RvciggY29sbGlzaW9uQm9yZGVyRGlzdGFuY2U6IENvbGxpc2lvbkJvcmRlckRpc3RhbmNlICkge1xyXG4gICAgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMgPSBjb2xsaXNpb25Cb3JkZXJEaXN0YW5jZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhbnlHcmVhdGVyVGhhbiggbnVtOiBudW1iZXIgKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMudG9wID4gbnVtXHJcbiAgICAgIHx8IHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnJpZ2h0ID4gbnVtXHJcbiAgICAgIHx8IHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLmJvdHRvbSA+IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5sZWZ0ID4gbnVtO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFueUxvd2VyVGhhbiggbnVtOiBudW1iZXIgKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMudG9wIDwgbnVtXHJcbiAgICAgIHx8IHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnJpZ2h0IDwgbnVtXHJcbiAgICAgIHx8IHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLmJvdHRvbSA8IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5sZWZ0IDwgbnVtO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFueUVxdWFscyggbnVtOiBudW1iZXIgKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMudG9wID09PSBudW1cclxuICAgICAgfHwgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMucmlnaHQgPT09IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5ib3R0b20gPT09IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5sZWZ0ID09PSBudW07XHJcbiAgfVxyXG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiXSwibmFtZXMiOlsiZGljdEtleXNCeUFjdGlvbiIsIk1hcCIsIm1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50IiwiZ2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCIsInRhcmdldCIsImF0dHJpYnV0ZU5hbWUiLCJoYXMiLCJzZXQiLCJyZXN1bHQiLCJkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lIiwiZ2V0IiwiZ2V0QXR0cmlidXRlIiwibmV3RGVmYXVsdEF0dHJpYnV0ZSIsInNldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQiLCJnZXRUcmFuc2Zvcm1Db29yZHNGcm9tRWxlbWVudCIsImVsZW1lbnQiLCJhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJ0cmFuc2Zvcm0iLCJtYXRjaCIsInJlZ2V4TnVtYmVyUGF0dGVybiIsIm1hcCIsIm4iLCJ4IiwidW5kZWZpbmVkIiwiTWF0aCIsInJvdW5kIiwieSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJwYWlyIiwiY29kZSIsImZvckVhY2giLCJrYkV2ZW50IiwibWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQiLCJtYXBFbGVtZW50c1RyaWdnZXJpbmdFdmVudHNCeVRhcmdldCIsImlzVmFsaWRUYXJnZXRUb1RyaWdnZXJFdmVudCIsImN1cnJlbnRUYXJnZXQiLCJ0YXJnZXRDbGFzc05hbWUiLCJ2YWxpZGF0ZURpc3RhbmNlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZUV4dHJhcyIsImRpc3RhbmNlRnJvbUJvcmRlciIsImFueUxvd2VyVGhhbiIsImRpc3RhbmNlVGhyZXNob2xkIiwiZ2V0RWxlbWVudHNJbnRlcmFjdGluZ1NldCIsIlNldCIsIlBpbkNvbGxpc2lvbkV2ZW50Iiwib25QaW4iLCJvblVucGluIiwicGluUG9zaXRpb25Gb3JtdWxhIiwidGFyZ2V0Q2xhc3MiLCJhdXRvSW5zZXJ0VGFyZ2V0Q2xhc3MiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJvbkNvbGxpZGluZyIsImRyYWdnYWJsZSIsIl9jb2xsaWRpbmdBdCIsImVsZW1lbnRzSW50ZXJhY3RpbmdTZXQiLCJuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlIiwicmVtb3ZlIiwiYWRkIiwiZGVsZXRlIiwib25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UiLCJ0YXJnZXRSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwicGluUG9zaXRpb24iLCJzdHlsZSIsInBpbkRyYWdnYWJsZUJ5Rm9ybXVsYSIsImRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uIiwidGFyZ2V0UmlnaHRQb3NpdGlvbiIsInJpZ2h0IiwidGFyZ2V0Qm90dG9tUG9zaXRpb24iLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsInBpbkRyYWdnYWJsZU9uQ2VudGVyIiwib25Ob3RDb2xsaWRpbmciLCJzaXplIiwiYWdlbnRDb2xsaXNpb25TZXQiLCJzZXRBdHRyaWJ1dGUiLCJ0b1N0cmluZyIsImRlZmF1bHRTaGFyZUF0dHJpYnV0ZUNvbGxpc2lvbkV2ZW50T3B0aW9ucyIsImtlZXBBdHRyaWJ1dGUiLCJTaGFyZUF0dHJpYnV0ZUNvbGxpc2lvbkV2ZW50Iiwib3B0aW9ucyIsIl9kaXN0YW5jZUZyb21Cb3JkZXIiLCJzaGFyZWRBdHRyaWJ1dGVOYW1lIiwic2hhcmVkQXR0cmlidXRlVmFsdWUiLCJoYW5kbGVFbGVtZW50SW50ZXJhY3Rpb25TaGFyZUF0dHJpYnV0ZSIsIm9uU2hhcmVkQXR0cmlidXRlRW1wdHkiLCJkZWZhdWx0U2hhcmVkQXR0cmlidXRlRnJvbVRhcmdldCIsInJlbW92ZUF0dHJpYnV0ZSIsIkNPTlZFUlNJT05fVU5JVCIsIkRJUkVDVElPTl9SRUZFUkVOQ0UiLCJWRVJUSUNBTF9SRUZFUkVOQ0UiLCJDT0xPUl9DSEFOTkVMIiwiY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzIiwiY29sbGlzaW9uQm9yZGVyRGlzdGFuY2UiLCJhbnlHcmVhdGVyVGhhbiIsIm51bSIsInRvcCIsImxlZnQiLCJhbnlFcXVhbHMiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSJdLCJzb3VyY2VSb290IjoiIn0=