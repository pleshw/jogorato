var PinCollisionEvent;(()=>{"use strict";var n={28:(n,t,e)=>{e.d(t,{getTransformCoordsFromElement:()=>s});var i=e(19);const o=new Map;function s(n){const t=(window.getComputedStyle(n).transform.match(i.regexNumberPattern)??[0,0]).map((n=>+n));return{x:void 0!==t[4]?Math.round(t[4]):0,y:void 0!==t[5]?Math.round(t[5]):0}}new Map,window.addEventListener("keydown",(n=>{for(const t of o)n.code===t[0]&&t[1].forEach((t=>t(n)))}))},513:(n,t,e)=>{e.d(t,{getElementsInteractingSet:()=>a,isValidTargetToTriggerEvent:()=>r,mapTargetsCollidingByTriggerElement:()=>o}),e(28);var i=e(676);new Map;const o=new Map,s=new Map;function r(n,t,e){return!!n.classList.contains(t)&&(!e||!new i.CollisionBorderDistanceExtras(e.distanceFromBorder).anyLowerThan(e.distanceThreshold))}function a(n){return s.has(n)||s.set(n,new Set),s.get(n)}new Map},19:(n,t,e)=>{e.d(t,{regexNumberPattern:()=>i});const i=/-?\d+\.?\d*/g},676:(n,t,e)=>{var i,o,s,r;e.d(t,{CollisionBorderDistanceExtras:()=>a}),function(n){n[n.PIXEL=0]="PIXEL",n[n.PERCENTAGE=1]="PERCENTAGE"}(i||(i={})),function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"}(o||(o={})),function(n){n[n.FROM_TOP=0]="FROM_TOP",n[n.FROM_BOTTOM=1]="FROM_BOTTOM"}(s||(s={})),function(n){n[n.R=0]="R",n[n.G=1]="G",n[n.B=2]="B",n[n.A=3]="A"}(r||(r={}));class a{collisionBorderDistances;constructor(n){this.collisionBorderDistances=n}anyGreaterThan(n){return this.collisionBorderDistances.top>n||this.collisionBorderDistances.right>n||this.collisionBorderDistances.bottom>n||this.collisionBorderDistances.left>n}anyLowerThan(n){return this.collisionBorderDistances.top<n||this.collisionBorderDistances.right<n||this.collisionBorderDistances.bottom<n||this.collisionBorderDistances.left<n}anyEquals(n){return this.collisionBorderDistances.top===n||this.collisionBorderDistances.right===n||this.collisionBorderDistances.bottom===n||this.collisionBorderDistances.left===n}}}},t={};function e(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return n[i](s,s.exports,e),s.exports}e.d=(n,t)=>{for(var i in t)e.o(t,i)&&!e.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:t[i]})},e.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),e.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var i={};(()=>{e.r(i),e.d(i,{PinCollisionEvent:()=>o,pinDraggableByFormula:()=>s,pinDraggableOnCenter:()=>r});var n=e(28),t=e(513);class o{onPin;onUnpin;pinPositionFormula;targetClass="pin-target";autoInsertTargetClass=!0;constructor({pinPositionFormula:n,onPin:t,onUnpin:e}){this.pinPositionFormula=n||void 0,this.onPin=t||void 0,this.onUnpin=e||void 0}async onColliding(n,e,i,o){if(!(0,t.isValidTargetToTriggerEvent)(e,this.targetClass))return;const a=(0,t.getElementsInteractingSet)(e),l="total-pinned-elements";if(n.classList.contains("dragging"))return n.classList.remove("pinned"),n.classList.add("ready-to-pin"),void(a.delete(n)&&(this.onElementInteractionChange(e,a,l),!this.onUnpin||this.onUnpin(n,e)));this.pinPositionFormula?s(n,e,o,this.pinPositionFormula):r(n,e,o),a.has(n)||(a.add(n),!this.onPin||this.onPin(n,e)),n.classList.add("pinned"),n.classList.remove("ready-to-pin"),this.onElementInteractionChange(e,a,l)}async onNotColliding(n,e){const i=(0,t.getElementsInteractingSet)(e);i.delete(n),i.size>0?e.classList.add("has-pinned-elements"):e.classList.remove("has-pinned-elements"),t.mapTargetsCollidingByTriggerElement.has(n)||t.mapTargetsCollidingByTriggerElement.set(n,new Set);const o=t.mapTargetsCollidingByTriggerElement.get(n);o.delete(e)&&0===o.size&&n.classList.remove("pinned","ready-to-pin")}onElementInteractionChange(n,t,e){t.size>0?n.classList.add("has-pinned-elements"):n.classList.remove("has-pinned-elements"),n.setAttribute(e,t.size.toString())}}function s(t,e,i,o){const s=e.getBoundingClientRect(),r=o(t.getBoundingClientRect(),s,(0,n.getTransformCoordsFromElement)(t),i);t.style.transform=`translate(${r.x}px, ${r.y}px)`}function r(t,e,i){const o=e.getBoundingClientRect(),s=(0,n.getTransformCoordsFromElement)(t),r=s.x+i.right,a=s.y+i.bottom;t.style.transform=`translate(${Math.round(r-o.width/2)}px, ${Math.round(a-o.height/2)}px)`}})(),PinCollisionEvent=i})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQXdCbEQsRUFBcUJKLEdBQ2pGLE1BQU1xRSxFQUFhakUsRUFBT2tFLHdCQUNwQkcsR0FBNkIsSUFBQXZHLCtCQUErQm9GLEdBQzVEb0IsRUFBc0JELEVBQTJCN0YsRUFBSW9CLEVBQW1Cb0IsTUFDeEV1RCxFQUF1QkYsRUFBMkJ6RixFQUFJZ0IsRUFBbUJxQixPQUMvRWlDLEVBQVVrQixNQUFNakcsVUFBWSxhQUFjTyxLQUFLQyxNQUFPMkYsRUFBd0JMLEVBQVdPLE1BQVEsU0FBYzlGLEtBQUtDLE1BQU80RixFQUF5Qk4sRUFBV1EsT0FBUyxPQUMxSyxDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vRE9NVG9vbHMudHMiLCJ3ZWJwYWNrOi8vLy4vRHJhZ2dhYmxlQWN0aW9uLnRzIiwid2VicGFjazovLy8uL01hdGhUb29scy50cyIsIndlYnBhY2s6Ly8vLi90eXBlcy50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly8vLi9QaW5Db2xsaXNpb25FdmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb2ludDJELCByZWdleE51bWJlclBhdHRlcm4gfSBmcm9tICcuL01hdGhUb29scyc7XHJcbmltcG9ydCB7IENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrLCBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSB9IGZyb20gJy4vdHlwZXMnO1xyXG5cclxuZXhwb3J0IHR5cGUgS2V5Ym9hcmRFdmVudENhbGxiYWNrID0gKCBldnQ6IEtleWJvYXJkRXZlbnQgKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGNvbnN0IGRpY3RLZXlzQnlBY3Rpb24gPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRBY3Rpb25LZXkoIGtleTogc3RyaW5nLCBldmVudDogS2V5Ym9hcmRFdmVudENhbGxiYWNrICkge1xyXG4gIGlmICggZGljdEtleXNCeUFjdGlvbi5oYXMoIGtleSApICkge1xyXG4gICAgZGljdEtleXNCeUFjdGlvbi5zZXQoIGtleSwgW2V2ZW50LCAuLi5kaWN0S2V5c0J5QWN0aW9uLmdldCgga2V5ICkhXSApXHJcbiAgfSBlbHNlIHtcclxuICAgIGRpY3RLZXlzQnlBY3Rpb24uc2V0KCBrZXksIFtldmVudF0gKVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrRWxlbWVudENvbGxpc2lvbiggZWxlbWVudDE6IEhUTUxFbGVtZW50LCBlbGVtZW50MjogSFRNTEVsZW1lbnQgKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgcmVjdDEgPSBlbGVtZW50MS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICBjb25zdCByZWN0MiA9IGVsZW1lbnQyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICByZXR1cm4gIShcclxuICAgIHJlY3QxLnRvcCA+IHJlY3QyLmJvdHRvbSB8fFxyXG4gICAgcmVjdDEucmlnaHQgPCByZWN0Mi5sZWZ0IHx8XHJcbiAgICByZWN0MS5ib3R0b20gPCByZWN0Mi50b3AgfHxcclxuICAgIHJlY3QxLmxlZnQgPiByZWN0Mi5yaWdodFxyXG4gICk7XHJcbn1cclxuXHJcbi8vLyBHZXQgdGhlIGRlZmF1bHQgYXR0cmlidXRlcyBmcm9tIHRoZSB0YXJnZXQgZWxlbWVudFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIG9uIG1hcCB3aWxsIHNldCB0aGUgY3VycmVudCBhdHRyaWJ1dGUgYXMgZGVmYXVsdFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIHdpbGwgcmV0dXJuIGFuIGVtcHR5IHN0cmluZ1xyXG5leHBvcnQgY29uc3QgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBNYXA8c3RyaW5nLCBzdHJpbmc+PigpO1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0OiBIVE1MRWxlbWVudCwgYXR0cmlidXRlTmFtZTogc3RyaW5nICk6IHN0cmluZyB7XHJcbiAgaWYgKCAhbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuaGFzKCB0YXJnZXQgKSApIHtcclxuICAgIG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LnNldCggdGFyZ2V0LCBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpICk7XHJcbiAgfVxyXG5cclxuICBsZXQgcmVzdWx0OiBzdHJpbmcgPSAnJztcclxuICBjb25zdCBkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lID0gbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSE7XHJcbiAgY29uc3QgdGFyZ2V0RGVmYXVsdEF0dHJpYnV0ZSA9ICFkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lLmhhcyggYXR0cmlidXRlTmFtZSApID8gdGFyZ2V0LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApIDogZGVmYXVsdEF0dHJpYnV0ZVZhbHVlc0J5TmFtZS5nZXQoIGF0dHJpYnV0ZU5hbWUgKSE7XHJcblxyXG4gIHJlc3VsdCA9IHRhcmdldERlZmF1bHRBdHRyaWJ1dGUgPyB0YXJnZXREZWZhdWx0QXR0cmlidXRlIDogJyc7XHJcbiAgc2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0LCBhdHRyaWJ1dGVOYW1lLCByZXN1bHQgKTtcclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQoIHRhcmdldDogSFRNTEVsZW1lbnQsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgbmV3RGVmYXVsdEF0dHJpYnV0ZTogc3RyaW5nICk6IHZvaWQge1xyXG4gIGlmICggIW1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5zZXQoIHRhcmdldCwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSApO1xyXG4gIH1cclxuXHJcbiAgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSEuc2V0KCBhdHRyaWJ1dGVOYW1lLCBuZXdEZWZhdWx0QXR0cmlidXRlICk7XHJcbn1cclxuXHJcbi8vLyBEaXZpZGUgbyBlbGVtZW50byBAdGFyZ2V0IGVtIDkgXCJxdWFkcmFkb3NcIiBpZ3VhaXMgZSByZXRvcm5hIGVtIHF1YWlzIHF1YWRyYWRvcyBvIGRyYWdnYWJsZSBlc3TDoSBjb2xpZGluZG8gY29tIG8gdGFyZ2V0XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDb2xsaXNpb25EaXJlY3Rpb24oIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQgKTogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2sge1xyXG4gIGNvbnN0IHJlY3QxID0gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IHJlY3QyID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICBjb25zdCBpc1RvcCA9IHJlY3QxLmJvdHRvbSA+IHJlY3QyLnRvcCAmJiByZWN0MS50b3AgPCByZWN0Mi50b3AgKyByZWN0Mi5oZWlnaHQgLyAzO1xyXG4gIGNvbnN0IGlzUmlnaHQgPSByZWN0MS5sZWZ0IDwgcmVjdDIucmlnaHQgJiYgcmVjdDEucmlnaHQgPiByZWN0Mi5yaWdodCAtIHJlY3QyLndpZHRoIC8gMztcclxuICBjb25zdCBpc0NlbnRlciA9IHJlY3QxLnRvcCA8IHJlY3QyLmJvdHRvbSAmJiByZWN0MS5ib3R0b20gPiByZWN0Mi50b3AgJiYgcmVjdDEubGVmdCA8IHJlY3QyLnJpZ2h0ICYmIHJlY3QxLnJpZ2h0ID4gcmVjdDIubGVmdDtcclxuICBjb25zdCBpc0JvdHRvbSA9IHJlY3QxLnRvcCA8IHJlY3QyLmJvdHRvbSAtIHJlY3QyLmhlaWdodCAvIDMgJiYgcmVjdDEuYm90dG9tID4gcmVjdDIuYm90dG9tIC0gcmVjdDIuaGVpZ2h0IC8gMztcclxuICBjb25zdCBpc0xlZnQgPSByZWN0MS5yaWdodCA+IHJlY3QyLmxlZnQgJiYgcmVjdDEubGVmdCA8IHJlY3QyLmxlZnQgKyByZWN0Mi53aWR0aCAvIDM7XHJcblxyXG4gIHJldHVybiB7IHRvcDogaXNUb3AsIHJpZ2h0OiBpc1JpZ2h0LCBjZW50ZXI6IGlzQ2VudGVyLCBib3R0b206IGlzQm90dG9tLCBsZWZ0OiBpc0xlZnQgfTtcclxufVxyXG5cclxuLy8vIHJldHVybiB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgY2VudGVyIG9mIHRoZSBkcmFnZ2FibGUgdG8gdGhlIGNlbnRlciBvZiB0aGUgdGFyZ2V0IGVsZW1lbnQgZnJvbSBlYWNoIGJvcmRlciBcclxuZXhwb3J0IGZ1bmN0aW9uIGdldERpc3RhbmNlRnJvbUJvcmRlciggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCApOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSB7XHJcbiAgY29uc3QgcmVjdDEgPSBkcmFnZ2FibGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgY29uc3QgcmVjdDIgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcblxyXG4gIGNvbnN0IGNlbnRlciA9IHtcclxuICAgIHg6IHJlY3QxLmxlZnQgKyByZWN0MS53aWR0aCAvIDIsXHJcbiAgICB5OiByZWN0MS50b3AgKyByZWN0MS5oZWlnaHQgLyAyLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGRpc3RhbmNlRnJvbUJvcmRlcjogQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UgPSB7XHJcbiAgICB0b3A6IGNlbnRlci55IC0gcmVjdDIudG9wLFxyXG4gICAgcmlnaHQ6IHJlY3QyLnJpZ2h0IC0gY2VudGVyLngsXHJcbiAgICBib3R0b206IHJlY3QyLmJvdHRvbSAtIGNlbnRlci55LFxyXG4gICAgbGVmdDogY2VudGVyLnggLSByZWN0Mi5sZWZ0LFxyXG4gIH07XHJcblxyXG4gIHJldHVybiBkaXN0YW5jZUZyb21Cb3JkZXI7XHJcbn1cclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIGV2dCA9PiB7XHJcbiAgZm9yICggY29uc3QgcGFpciBvZiBkaWN0S2V5c0J5QWN0aW9uICkge1xyXG4gICAgaWYgKCBldnQuY29kZSA9PT0gcGFpclswXSApIHtcclxuICAgICAgcGFpclsxXS5mb3JFYWNoKCBrYkV2ZW50ID0+IGtiRXZlbnQoIGV2dCApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59ICk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IFBvaW50MkQge1xyXG4gIGNvbnN0IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbWVudCApLnRyYW5zZm9ybS5tYXRjaCggcmVnZXhOdW1iZXJQYXR0ZXJuICkgPz8gWzAsIDBdICkubWFwKCBuID0+ICtuICk7XHJcbiAgcmV0dXJuIHtcclxuICAgIHg6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzRdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs0XSApIDogMCxcclxuICAgIHk6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzVdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs1XSApIDogMFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsaWNrRXZlbnRUb0Nvb3JkaW5hdGVzKCBldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQgKSB7XHJcbiAgaWYgKCBldmVudCBpbnN0YW5jZW9mIE1vdXNlRXZlbnQgKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiBldmVudC5jbGllbnRYLFxyXG4gICAgICB5OiBldmVudC5jbGllbnRZXHJcbiAgICB9O1xyXG4gIH0gZWxzZSBpZiAoIGV2ZW50IGluc3RhbmNlb2YgVG91Y2hFdmVudCApIHtcclxuICAgIGNvbnN0IHRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0b3VjaC5jbGllbnRYLFxyXG4gICAgICB5OiB0b3VjaC5jbGllbnRZXHJcbiAgICB9O1xyXG4gIH0gZWxzZSB7XHJcbiAgICB0aHJvdyBcIkV2ZW50IG5vdCBGb3VuZFwiO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGhpZGVFbGVtZW50KCBlbGVtZW50OiBIVE1MRWxlbWVudCApIHtcclxuICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gIGVsZW1lbnQuc3R5bGUuekluZGV4ID0gJy0xJztcclxuICBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAnMCc7XHJcbiAgZWxlbWVudC5zdHlsZS53aWR0aCA9ICcwcHggIWltcG9ydGFudCc7XHJcbiAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnMHB4ICFpbXBvcnRhbnQnO1xyXG4gIGVsZW1lbnQuc2V0QXR0cmlidXRlKCAnaGlkZGVuJywgJycgKTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNsZWVwQXN5bmMoIG1zOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KCAoIHJlc29sdmUgKSA9PiBzZXRUaW1lb3V0KCAoKSA9PiByZXNvbHZlKCksIG1zICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJpbmRFbGVtZW50c0J5Q2hlY2soIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCwgb25DaGVjazogRnVuY3Rpb24sIG9uVW5jaGVjazogRnVuY3Rpb24gKSB7XHJcbiAgaWYgKCB0cmlnZ2VyRWxlbWVudC5jaGVja2VkICkge1xyXG4gICAgb25DaGVjayggdGFyZ2V0RWxlbWVudCApO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdHJpZ2dlckdyb3VwID0gdHJpZ2dlckVsZW1lbnQubmFtZVxyXG4gICAgPyBBcnJheS5mcm9tKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCBgW25hbWU9XCIkeyB0cmlnZ2VyRWxlbWVudC5uYW1lIH1cIl1gICkgKVxyXG4gICAgOiBbdHJpZ2dlckVsZW1lbnRdO1xyXG5cclxuICB0cmlnZ2VyR3JvdXAuZm9yRWFjaCggdCA9PiB0LmFkZEV2ZW50TGlzdGVuZXIoICdjaGFuZ2UnLCBldnQgPT4ge1xyXG4gICAgaWYgKCB0cmlnZ2VyRWxlbWVudC5jaGVja2VkICkge1xyXG4gICAgICBvbkNoZWNrKCB0YXJnZXRFbGVtZW50LCBldnQgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG9uVW5jaGVjayggdGFyZ2V0RWxlbWVudCwgZXZ0ICk7XHJcbiAgICB9XHJcbiAgfSApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc01vYmlsZUJyb3dzZXIoKSB7XHJcbiAgcmV0dXJuIC9BbmRyb2lkfGlQaG9uZS9pLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzT25TY3JlZW4oIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICkge1xyXG4gIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIHJldHVybiAoXHJcbiAgICByZWN0LnRvcCA+PSAwICYmXHJcbiAgICByZWN0LmxlZnQgPj0gMCAmJlxyXG4gICAgcmVjdC5ib3R0b20gPD0gKCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCApICYmXHJcbiAgICByZWN0LnJpZ2h0IDw9ICggd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIClcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYmluZEVsZW1lbnRWaWV3SWZDaGVja2VkKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgb3B0aW9ucyA9IHtcclxuICBvbkNoZWNrOiAoIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCApID0+IHsgfSxcclxuICBvblVuY2hlY2s6ICggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50ICkgPT4geyB9XHJcbn0gKSB7XHJcbiAgYmluZEVsZW1lbnRzQnlDaGVjayhcclxuICAgIHRyaWdnZXJFbGVtZW50LFxyXG4gICAgdGFyZ2V0RWxlbWVudCxcclxuICAgICggZWw6IEhUTUxFbGVtZW50ICkgPT4ge1xyXG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKCAnc2hvdycgKTtcclxuICAgICAgb3B0aW9ucy5vbkNoZWNrKCB0cmlnZ2VyRWxlbWVudCwgdGFyZ2V0RWxlbWVudCApO1xyXG4gICAgfSxcclxuICAgICggZWw6IEhUTUxFbGVtZW50ICkgPT4ge1xyXG4gICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKCAnc2hvdycgKTtcclxuICAgICAgb3B0aW9ucy5vblVuY2hlY2soIHRyaWdnZXJFbGVtZW50LCB0YXJnZXRFbGVtZW50ICk7XHJcbiAgICB9LFxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZUZyb21SYWRpb0dyb3VwKCBncm91cE5hbWU6IHN0cmluZyApOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvciggYFtuYW1lPSR7IGdyb3VwTmFtZSB9XTpjaGVja2VkYCApIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgaWYgKCBlbCApIHtcclxuICAgIHJldHVybiBlbC52YWx1ZTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4vLyBSZXRvcm5hIHVtYSBmdW7Dp8OjbyBxdWUgbsOjbyB2YWkgc2VyIGNvbXBsZXRhZGEgY2FzbyBzZWphIGNoYW1hZGEgbm92YW1lbnRlIGVtIHsgZGVsYXkgfSBtaWxpc3NlZ3VuZG9zXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWJvdW5jZUZhY3RvcnkoIGZ1bmM6IEZ1bmN0aW9uLCBkZWxheTogbnVtYmVyICk6IEZ1bmN0aW9uIHtcclxuICBsZXQgaW5EZWJvdW5jZTogbnVtYmVyO1xyXG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gd2luZG93O1xyXG4gICAgY29uc3QgYXJncyA9IGFyZ3VtZW50cztcclxuICAgIGNsZWFyVGltZW91dCggaW5EZWJvdW5jZSApO1xyXG4gICAgaW5EZWJvdW5jZSA9IHdpbmRvdy5zZXRUaW1lb3V0KCAoKSA9PiBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICksIGRlbGF5ICk7XHJcbiAgfTtcclxufVxyXG5cclxuLy8gUmV0b3JuYSB1bWEgZnVuw6fDo28gcXVlIHPDsyBwb2RlIHNlciBjb21wbGV0YWRhIHVtYSB2ZXogYSBjYWRhIHsgbGltaXQgfSBtaWxpc3NlZ3VuZG9zIFxyXG5leHBvcnQgZnVuY3Rpb24gdGhyb3R0bGVGYWN0b3J5KCBmdW5jOiBGdW5jdGlvbiwgbGltaXQ6IG51bWJlciApOiBGdW5jdGlvbiB7XHJcbiAgbGV0IGxhc3RGdW5jOiBudW1iZXI7XHJcbiAgbGV0IGxhc3RSYW46IG51bWJlcjtcclxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdpbmRvdztcclxuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBpZiAoICFsYXN0UmFuICkge1xyXG4gICAgICBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICk7XHJcbiAgICAgIGxhc3RSYW4gPSBEYXRlLm5vdygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KCBsYXN0RnVuYyApO1xyXG4gICAgICBsYXN0RnVuYyA9IHdpbmRvdy5zZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCBEYXRlLm5vdygpIC0gbGFzdFJhbiA+PSBsaW1pdCApIHtcclxuICAgICAgICAgIGZ1bmMuYXBwbHkoIGNvbnRleHQsIGFyZ3MgKTtcclxuICAgICAgICAgIGxhc3RSYW4gPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgbGltaXQgLSAoIERhdGUubm93KCkgLSBsYXN0UmFuICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbW9vdGhTY3JvbGxUbyggcG9zOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgd2luZG93LnNjcm9sbFRvKCB7XHJcbiAgICB0b3A6IHBvcyxcclxuICAgIGJlaGF2aW9yOiAnc21vb3RoJyxcclxuICB9ICk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VsZWN0T3B0aW9uQnlUZXh0KCBpZFNlbGVjdEVsZW1lbnQ6IHN0cmluZywgc2VhcmNoVGV4dDogc3RyaW5nLCBjb250YWluczogYm9vbGVhbiA9IGZhbHNlICk6IHZvaWQge1xyXG4gIGNvbnN0IHNlbGVjdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggaWRTZWxlY3RFbGVtZW50ICkgYXMgSFRNTFNlbGVjdEVsZW1lbnQ7XHJcblxyXG4gIGlmICggIXNlbGVjdEVsZW1lbnQgKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjb25zdCBvcHRpb25zRWxlbWVudG9TZWxlY3QgPSBbLi4uc2VsZWN0RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnb3B0aW9uJyApXTtcclxuXHJcbiAgbGV0IHNlbGVjdGVkT3B0aW9uO1xyXG4gIGlmICggY29udGFpbnMgKSB7XHJcbiAgICBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnNFbGVtZW50b1NlbGVjdFxyXG4gICAgICAuZmlsdGVyKCBlbCA9PiBlbC50ZXh0Q29udGVudCAmJiBlbC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkgKSApWzBdLnZhbHVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnNFbGVtZW50b1NlbGVjdFxyXG4gICAgICAuZmlsdGVyKCBlbCA9PiBlbC50ZXh0Q29udGVudCAmJiBlbC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpID09PSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkgKVswXS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHNlbGVjdEVsZW1lbnQudmFsdWUgPSBzZWxlY3RlZE9wdGlvbjtcclxufVxyXG5cclxuIiwiaW1wb3J0IHsgY2hlY2tFbGVtZW50Q29sbGlzaW9uLCBnZXRDb2xsaXNpb25EaXJlY3Rpb24sIGdldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQsIGdldERpc3RhbmNlRnJvbUJvcmRlciB9IGZyb20gJy4vRE9NVG9vbHMnO1xyXG5pbXBvcnQgeyBDb2xsaXNpb25UcmlnZ2VyT3B0aW9ucyBhcyBDb2xsaXNpb25UcmlnZ2VyLCBDb2xsaXNpb25EaXJlY3Rpb25DaGVjaywgQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UsIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlRXh0cmFzLCBJQ29sbGlzaW9uRXZlbnQgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCBjb25zdCBtYXBFbGVtZW50c0NvbGxpZGluZ0J5VGFyZ2V0cyA9IG5ldyBNYXA8SFRNTEVsZW1lbnQsIFNldDxIVE1MRWxlbWVudD4+KCk7XHJcbmV4cG9ydCBjb25zdCBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudCA9IG5ldyBNYXA8SFRNTEVsZW1lbnQsIFNldDxIVE1MRWxlbWVudD4+KCk7XHJcbmV4cG9ydCBjb25zdCBtYXBFbGVtZW50c1RyaWdnZXJpbmdFdmVudHNCeVRhcmdldCA9IG5ldyBNYXA8SFRNTEVsZW1lbnQsIFNldDxIVE1MRWxlbWVudD4+KCk7XHJcblxyXG5sZXQgY29sbGlzaW9uQ2hlY2tJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQ7XHJcbmNvbnN0IGNvbGxpc2lvbkV2ZW50c0J5U2VsZWN0b3JzID0gbmV3IE1hcDxzdHJpbmcsIENvbGxpc2lvblRyaWdnZXJbXT4oKTtcclxuXHJcblxyXG4vLy8gcHVzaCBldmVudHMgdG8gYSBkaWN0aW9uYXJ5IGFuZCBpZiB0aGV5IGV4aXN0IGp1c3QgYWRkIG5ldyB0YXJnZXRzIHRvIHRoZW1cclxuZXhwb3J0IGZ1bmN0aW9uIGluc2VydEludG9FdmVudENoZWNrTGlzdCggZWxlbWVudFRvQ2hlY2s6IEhUTUxFbGVtZW50LCB0YXJnZXRRdWVyeVNlbGVjdG9yOiBzdHJpbmcsIGNvbGxpc2lvbkV2ZW50czogSUNvbGxpc2lvbkV2ZW50W10gKSB7XHJcbiAgY29uc3QgcmVmRXhpc3RpbmdFdmVudDogQ29sbGlzaW9uVHJpZ2dlcltdIHwgdW5kZWZpbmVkID0gY29sbGlzaW9uRXZlbnRzQnlTZWxlY3RvcnMuZ2V0KCB0YXJnZXRRdWVyeVNlbGVjdG9yICk7XHJcbiAgaWYgKCByZWZFeGlzdGluZ0V2ZW50ICkge1xyXG4gICAgcmVmRXhpc3RpbmdFdmVudC5wdXNoKCB7XHJcbiAgICAgIHRyaWdnZXJFbGVtZW50OiBlbGVtZW50VG9DaGVjayxcclxuICAgICAgZXZlbnRzOiBjb2xsaXNpb25FdmVudHNcclxuICAgIH0gKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29sbGlzaW9uRXZlbnRzQnlTZWxlY3RvcnMuc2V0KCB0YXJnZXRRdWVyeVNlbGVjdG9yLCBbe1xyXG4gICAgICB0cmlnZ2VyRWxlbWVudDogZWxlbWVudFRvQ2hlY2ssXHJcbiAgICAgIGV2ZW50czogY29sbGlzaW9uRXZlbnRzXHJcbiAgICB9XSApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuTm90Q29sbGlkaW5nRWxlbWVudHNBdHRyaWJ1dGVzQW5kQ2xhc3NlcyggdHJpZ2dlckVsZW1lbnRzQ29sbGlzaW9uOiBTZXQ8SFRNTEVsZW1lbnQ+LCB0YXJnZXQ6IEhUTUxFbGVtZW50LCB0YXJnZXRDb2xsaXNpb246IFNldDxIVE1MRWxlbWVudD4sIGFnZW50OiBDb2xsaXNpb25UcmlnZ2VyICkge1xyXG4gIGlmICggdHJpZ2dlckVsZW1lbnRzQ29sbGlzaW9uLmRlbGV0ZSggdGFyZ2V0IGFzIEhUTUxFbGVtZW50ICkgJiYgdHJpZ2dlckVsZW1lbnRzQ29sbGlzaW9uLnNpemUgPT09IDAgKSB7XHJcbiAgICBhZ2VudC50cmlnZ2VyRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCAnY29sbGlkaW5nJyApO1xyXG4gIH1cclxuXHJcbiAgaWYgKCB0YXJnZXRDb2xsaXNpb24uZGVsZXRlKCBhZ2VudC50cmlnZ2VyRWxlbWVudCApICYmIHRhcmdldENvbGxpc2lvbi5zaXplID09PSAwICkge1xyXG4gICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoICdjb2xsaWRpbmcnICk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0Q29sbGlzaW9uQ2xhc3NlcyggY29sbGlzaW9uVHJpZ2dlcjogQ29sbGlzaW9uVHJpZ2dlciwgdGFyZ2V0OiBIVE1MRWxlbWVudCApIHtcclxuICBjb2xsaXNpb25UcmlnZ2VyLnRyaWdnZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoICdjb2xsaWRpbmcnICk7XHJcbiAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoICdjb2xsaWRpbmcnICk7XHJcbn1cclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiB0cmlnZ2VyQ29sbGlzaW9uRXZlbnRzQXN5bmMoIGNvbGxpc2lvblRyaWdnZXI6IENvbGxpc2lvblRyaWdnZXIsIHRhcmdldDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgY29uc3QgY29sbGlkaW5nQXQgPSBnZXRDb2xsaXNpb25EaXJlY3Rpb24oIGNvbGxpc2lvblRyaWdnZXIudHJpZ2dlckVsZW1lbnQsIHRhcmdldCApO1xyXG4gIGNvbnN0IGRpc3RhbmNlRnJvbUJvcmRlciA9IGdldERpc3RhbmNlRnJvbUJvcmRlciggY29sbGlzaW9uVHJpZ2dlci50cmlnZ2VyRWxlbWVudCwgdGFyZ2V0ICk7XHJcbiAgYXdhaXQgUHJvbWlzZS5hbGwoIGNvbGxpc2lvblRyaWdnZXIuZXZlbnRzLm1hcCggYXN5bmMgZXZlbnQgPT4ge1xyXG4gICAgYXdhaXQgZXZlbnQub25Db2xsaWRpbmcoXHJcbiAgICAgIGNvbGxpc2lvblRyaWdnZXIudHJpZ2dlckVsZW1lbnQsXHJcbiAgICAgIHRhcmdldCxcclxuICAgICAgY29sbGlkaW5nQXQsXHJcbiAgICAgIGRpc3RhbmNlRnJvbUJvcmRlclxyXG4gICAgKTtcclxuICB9ICkgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0VGFyZ2V0Q2xhc3Nlc0ZvckV2ZW50cyggY29sbGlzaW9uVHJpZ2dlcnM6IENvbGxpc2lvblRyaWdnZXJbXSwgY29sbGlzaW9uVGFyZ2V0U2VsZWN0b3JzOiBzdHJpbmcgKTogdm9pZCB7XHJcbiAgY29uc3QgYXJyVGFyZ2V0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGNvbGxpc2lvblRhcmdldFNlbGVjdG9ycyApXHJcblxyXG4gIGFyclRhcmdldHMuZm9yRWFjaCggdGFyZ2V0ID0+IHtcclxuICAgIGNvbGxpc2lvblRyaWdnZXJzLmZvckVhY2goIGFnZW50ID0+IHtcclxuICAgICAgYWdlbnQuZXZlbnRzLmZvckVhY2goICggZSApID0+IHtcclxuICAgICAgICBpZiAoIGUuYXV0b0luc2VydFRhcmdldENsYXNzICkge1xyXG4gICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoIGUudGFyZ2V0Q2xhc3MgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gKVxyXG4gICAgfSApO1xyXG4gIH0gKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U2V0T2ZFbGVtZW50c0NvbGxpZGluZ1dpdGhUYXJnZXRzKCB0YXJnZXQ6IEhUTUxFbGVtZW50ICk6IFNldDxIVE1MRWxlbWVudD4ge1xyXG4gIGlmICggIW1hcEVsZW1lbnRzQ29sbGlkaW5nQnlUYXJnZXRzLmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBFbGVtZW50c0NvbGxpZGluZ0J5VGFyZ2V0cy5zZXQoIHRhcmdldCwgbmV3IFNldDxIVE1MRWxlbWVudD4oKSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG1hcEVsZW1lbnRzQ29sbGlkaW5nQnlUYXJnZXRzLmdldCggdGFyZ2V0ICkhO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTZXRPZkVsZW1lbnRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudCggdHJpZ2dlckVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IFNldDxIVE1MRWxlbWVudD4ge1xyXG4gIGlmICggIW1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LmhhcyggdHJpZ2dlckVsZW1lbnQgKSApIHtcclxuICAgIG1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LnNldCggdHJpZ2dlckVsZW1lbnQsIG5ldyBTZXQ8SFRNTEVsZW1lbnQ+KCkgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudC5nZXQoIHRyaWdnZXJFbGVtZW50ICkhO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRDb2xsaXNpb25DaGVjaygpIHtcclxuICBjb2xsaXNpb25FdmVudHNCeVNlbGVjdG9ycy5mb3JFYWNoKCAoIGNvbGxpc2lvblRyaWdnZXJzLCBjb2xsaXNpb25UYXJnZXRTZWxlY3RvcnMgKSA9PiB7XHJcbiAgICBzZXRUYXJnZXRDbGFzc2VzRm9yRXZlbnRzKCBjb2xsaXNpb25UcmlnZ2VycywgY29sbGlzaW9uVGFyZ2V0U2VsZWN0b3JzICk7XHJcbiAgfSApO1xyXG5cclxuICBjb2xsaXNpb25DaGVja0ludGVydmFsID0gc2V0SW50ZXJ2YWwoICgpID0+IHtcclxuICAgIGNvbGxpc2lvbkV2ZW50c0J5U2VsZWN0b3JzLmZvckVhY2goIGFzeW5jICggY29sbGlzaW9uVHJpZ2dlcnMsIGNvbGxpc2lvblRhcmdldFNlbGVjdG9ycyApID0+IHtcclxuICAgICAgY29uc3QgYXJyVGFyZ2V0cyA9IEFycmF5LmZyb20oIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGNvbGxpc2lvblRhcmdldFNlbGVjdG9ycyApICkgYXMgSFRNTEVsZW1lbnRbXTtcclxuXHJcbiAgICAgIHNldENvbGxpc2lvbkV2ZW50c0ZvclRhcmdldHMoIGFyclRhcmdldHMsIGNvbGxpc2lvblRyaWdnZXJzICk7XHJcbiAgICB9ICk7XHJcbiAgfSwgNTAgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Q29sbGlzaW9uRXZlbnRzRm9yVGFyZ2V0cyggYXJyVGFyZ2V0czogSFRNTEVsZW1lbnRbXSwgY29sbGlzaW9uVHJpZ2dlcnM6IENvbGxpc2lvblRyaWdnZXJbXSApIHtcclxuICBhcnJUYXJnZXRzLmZvckVhY2goIGFzeW5jIHRhcmdldCA9PiB7XHJcbiAgICBjb25zdCB0YXJnZXRDb2xsaXNpb25TZXQ6IFNldDxIVE1MRWxlbWVudD4gPSBnZXRTZXRPZkVsZW1lbnRzQ29sbGlkaW5nV2l0aFRhcmdldHMoIHRhcmdldCApO1xyXG5cclxuICAgIGNvbGxpc2lvblRyaWdnZXJzLmZvckVhY2goIGFzeW5jIHRyaWdnZXIgPT4ge1xyXG4gICAgICBpZiAoIHRyaWdnZXIudHJpZ2dlckVsZW1lbnQgPT09IHRhcmdldCApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRyaWdnZXJDb2xsaXNpb25TZXQ6IFNldDxIVE1MRWxlbWVudD4gPSBnZXRTZXRPZkVsZW1lbnRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudCggdHJpZ2dlci50cmlnZ2VyRWxlbWVudCApO1xyXG5cclxuICAgICAgY29uc3QgaXNDb2xsaXNpb246IGJvb2xlYW4gPSBjaGVja0VsZW1lbnRDb2xsaXNpb24oIHRyaWdnZXIudHJpZ2dlckVsZW1lbnQsIHRhcmdldCApO1xyXG5cclxuICAgICAgaWYgKCAhaXNDb2xsaXNpb24gKSB7XHJcbiAgICAgICAgYXdhaXQgb25FbGVtZW50c05vdENvbGxpZGluZyggdHJpZ2dlckNvbGxpc2lvblNldCwgdGFyZ2V0LCB0YXJnZXRDb2xsaXNpb25TZXQsIHRyaWdnZXIgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRyaWdnZXJDb2xsaXNpb25TZXQuYWRkKCB0YXJnZXQgKTtcclxuICAgICAgdGFyZ2V0Q29sbGlzaW9uU2V0LmFkZCggdHJpZ2dlci50cmlnZ2VyRWxlbWVudCApO1xyXG5cclxuICAgICAgc2V0Q29sbGlzaW9uQ2xhc3NlcyggdHJpZ2dlciwgdGFyZ2V0ICk7XHJcblxyXG4gICAgICBhd2FpdCB0cmlnZ2VyQ29sbGlzaW9uRXZlbnRzQXN5bmMoIHRyaWdnZXIsIHRhcmdldCApO1xyXG4gICAgfSApO1xyXG4gIH0gKTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gb25FbGVtZW50c05vdENvbGxpZGluZyggdHJpZ2dlckNvbGxpc2lvblNldDogU2V0PEhUTUxFbGVtZW50PiwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgdGFyZ2V0Q29sbGlzaW9uU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+LCB0cmlnZ2VyOiBDb2xsaXNpb25UcmlnZ2VyICkge1xyXG4gIGNsZWFuTm90Q29sbGlkaW5nRWxlbWVudHNBdHRyaWJ1dGVzQW5kQ2xhc3NlcyhcclxuICAgIHRyaWdnZXJDb2xsaXNpb25TZXQsXHJcbiAgICB0YXJnZXQsXHJcbiAgICB0YXJnZXRDb2xsaXNpb25TZXQsXHJcbiAgICB0cmlnZ2VyXHJcbiAgKTtcclxuXHJcbiAgYXdhaXQgUHJvbWlzZS5hbGwoIHRyaWdnZXIuZXZlbnRzLm1hcCggYXN5bmMgZXZlbnQgPT4ge1xyXG4gICAgYXdhaXQgZXZlbnQub25Ob3RDb2xsaWRpbmcoXHJcbiAgICAgIHRyaWdnZXIudHJpZ2dlckVsZW1lbnQsXHJcbiAgICAgIHRhcmdldFxyXG4gICAgKTtcclxuICB9ICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluaXRDb2xsaXNpb25DaGVja09uKCBlbGVtZW50VG9DaGVjazogSFRNTEVsZW1lbnQsIHRhcmdldFF1ZXJ5U2VsZWN0b3I6IHN0cmluZywgY29sbGlzaW9uRXZlbnRzOiBJQ29sbGlzaW9uRXZlbnRbXSApOiB2b2lkIHtcclxuICBpbnNlcnRJbnRvRXZlbnRDaGVja0xpc3QoIGVsZW1lbnRUb0NoZWNrLCB0YXJnZXRRdWVyeVNlbGVjdG9yLCBjb2xsaXNpb25FdmVudHMgKTtcclxuXHJcbiAgaWYgKCBjb2xsaXNpb25DaGVja0ludGVydmFsICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgc2V0Q29sbGlzaW9uQ2hlY2soKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRUYXJnZXRUb1RyaWdnZXJFdmVudCggY3VycmVudFRhcmdldDogSFRNTEVsZW1lbnQsIHRhcmdldENsYXNzTmFtZTogc3RyaW5nLCB2YWxpZGF0ZURpc3RhbmNlPzogeyBkaXN0YW5jZVRocmVzaG9sZDogbnVtYmVyLCBkaXN0YW5jZUZyb21Cb3JkZXI6IENvbGxpc2lvbkJvcmRlckRpc3RhbmNlIH0gKTogYm9vbGVhbiB7XHJcbiAgaWYgKCAhY3VycmVudFRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIHRhcmdldENsYXNzTmFtZSApICkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgaWYgKCB2YWxpZGF0ZURpc3RhbmNlICkge1xyXG4gICAgLy8vIENoZWNrcyBob3cgbWFueSBwaXhlbHMgdGhlIGRyYWdnYWJsZSBpcyBpbnNpZGUgZnJvbSBlYWNoIGJvcmRlcjsgaWYgdGhlIGVsZW1lbnQgaXMgb3ZlciB0aGUgdGhyZXNob2xkIHRoZSBmdW5jdGlvbiB3aWxsIHJldHVybiB0cnVlO1xyXG4gICAgY29uc3QgY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VFeHRyYXMgPSBuZXcgQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2VFeHRyYXMoIHZhbGlkYXRlRGlzdGFuY2UuZGlzdGFuY2VGcm9tQm9yZGVyICk7XHJcbiAgICBpZiAoIGNvbGxpc2lvbkJvcmRlckRpc3RhbmNlRXh0cmFzLmFueUxvd2VyVGhhbiggdmFsaWRhdGVEaXN0YW5jZS5kaXN0YW5jZVRocmVzaG9sZCApICkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQoIHRhcmdldDogSFRNTEVsZW1lbnQgKTogU2V0PEhUTUxFbGVtZW50PiB7XHJcbiAgaWYgKCAhbWFwRWxlbWVudHNUcmlnZ2VyaW5nRXZlbnRzQnlUYXJnZXQuaGFzKCB0YXJnZXQgKSApIHtcclxuICAgIG1hcEVsZW1lbnRzVHJpZ2dlcmluZ0V2ZW50c0J5VGFyZ2V0LnNldCggdGFyZ2V0LCBuZXcgU2V0PEhUTUxFbGVtZW50PigpICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbWFwRWxlbWVudHNUcmlnZ2VyaW5nRXZlbnRzQnlUYXJnZXQuZ2V0KCB0YXJnZXQgKSE7XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IHJlZ2V4TnVtYmVyUGF0dGVybiA9IC8tP1xcZCtcXC4/XFxkKi9nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQb2ludDJEIHtcclxuICB4OiBudW1iZXI7XHJcbiAgeTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERpbWVuc2lvbnMge1xyXG4gIHdpZHRoOiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbmRleFRvUm93KCBpbmRleDogbnVtYmVyLCBncmlkV2lkdGg6IG51bWJlciApIHtcclxuICByZXR1cm4gTWF0aC5mbG9vciggaW5kZXggLyBncmlkV2lkdGggKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluZGV4VG9Db2woIGluZGV4OiBudW1iZXIsIGdyaWRXaWR0aDogbnVtYmVyICkge1xyXG4gIHJldHVybiBpbmRleCAlIGdyaWRXaWR0aDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJvd0NvbFRvSW5kZXgoIHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgd2lkdGg6IG51bWJlciApIHtcclxuICByZXR1cm4gKCByb3cgKiB3aWR0aCApICsgY29sO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxlcnAoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciwgYW1vdW50OiBudW1iZXIgKTogbnVtYmVyIHtcclxuICByZXR1cm4gKCAxIC0gYW1vdW50ICkgKiBtaW4gKyBhbW91bnQgKiBtYXg7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbnZlcnNlTGVycCggYTogbnVtYmVyLCBiOiBudW1iZXIsIHZhbDogbnVtYmVyICk6IG51bWJlciB7XHJcbiAgcmV0dXJuICggdmFsIC0gYSApIC8gKCBiIC0gYSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVtYXAoIGluTWluOiBudW1iZXIsIGluTWF4OiBudW1iZXIsIG91dE1pbjogbnVtYmVyLCBvdXRNYXg6IG51bWJlciwgdmFsOiBudW1iZXIgKTogbnVtYmVyIHtcclxuICByZXR1cm4gbGVycCggb3V0TWluLCBvdXRNYXgsIGludmVyc2VMZXJwKCBpbk1pbiwgaW5NYXgsIHZhbCApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSYW5kb21JbnRFeGNsdXNpdmUoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciApIHtcclxuICByZXR1cm4gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICggbWF4IC0gbWluICkgKyBtaW4gKTtcclxufVxyXG5cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmFuZG9tSW50SW5jbHVzaXZlKCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIgKSB7XHJcbiAgbWluID0gTWF0aC5jZWlsKCBtaW4gKTtcclxuICBtYXggPSBNYXRoLmZsb29yKCBtYXggKTtcclxuICByZXR1cm4gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICggbWF4IC0gbWluICsgMSApICkgKyBtaW47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSYW5kb21Gcm9tQXJyYXk8VD4oIGFycjogQXJyYXk8VD4gKSB7XHJcbiAgcmV0dXJuIGFycltnZXRSYW5kb21JbnRFeGNsdXNpdmUoIDAsIGFyci5sZW5ndGggKV07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGFtcCggbnVtOiBudW1iZXIgPSAwLCBtaW46IG51bWJlciA9IDAsIG1heDogbnVtYmVyID0gMTAwICk6IG51bWJlciB7XHJcbiAgcmV0dXJuIE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBudW0sIG1heCApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaW51dGVzVG9NaWxsaXNlY29uZHMoIG1zOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG1zICogNjAwMDA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaWxsaXNlY29uZHNUb01pbnV0ZXMoIG1zOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG1zIC8gNjAwMDA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtaWxsaXNlY29uZHNUb0hvdXJzKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBtcyAvIDMuNmUrNjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pbGxpc2Vjb25kc1RvRGF5cyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gbXMgLyA4LjY0ZSs3O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWVnYWJ5dGVUb0J5dGUoIG1iOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG1iICogMTAyNCAqIDEwMjQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBieXRlVG9NZWdhYnl0ZSggYjogbnVtYmVyICkge1xyXG4gIHJldHVybiBiIC8gMTAyNCAvIDEwMjQ7XHJcbn0iLCJpbXBvcnQgeyBJUG9pbnQyRCB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcblxyXG5leHBvcnQgZW51bSBDT05WRVJTSU9OX1VOSVQgeyBQSVhFTCwgUEVSQ0VOVEFHRSB9XHJcbmV4cG9ydCBlbnVtIERJUkVDVElPTl9SRUZFUkVOQ0UgeyBIT1JJWk9OVEFMLCBWRVJUSUNBTCB9XHJcbmV4cG9ydCBlbnVtIFZFUlRJQ0FMX1JFRkVSRU5DRSB7IEZST01fVE9QLCBGUk9NX0JPVFRPTSB9XHJcblxyXG5leHBvcnQgZW51bSBDT0xPUl9DSEFOTkVMIHsgUiwgRywgQiwgQSB9O1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBDb21wYXJhYmxlPFQ+IHtcclxuICBlcXVhbHMoIGI6IFQgKTogYm9vbGVhbjtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBDU1NQb3NpdGlvbiBpbXBsZW1lbnRzIElQb2ludDJEIHtcclxuICBwdWJsaWMgeDogbnVtYmVyO1xyXG4gIHB1YmxpYyB5OiBudW1iZXI7XHJcbiAgcHJpdmF0ZSB0eXBlOiBDT05WRVJTSU9OX1VOSVQ7XHJcbiAgcHVibGljIHZlcnRpY2FsUmVmZXJlbmNlOiBWRVJUSUNBTF9SRUZFUkVOQ0U7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCB7IHgsIHksIHZlcnRpY2FsUmVmZXJlbmNlID0gVkVSVElDQUxfUkVGRVJFTkNFLkZST01fVE9QLCB0eXBlID0gQ09OVkVSU0lPTl9VTklULlBJWEVMIH06IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IHZlcnRpY2FsUmVmZXJlbmNlPzogVkVSVElDQUxfUkVGRVJFTkNFOyB0eXBlPzogQ09OVkVSU0lPTl9VTklUOyB9ICkge1xyXG4gICAgW3RoaXMueCwgdGhpcy55LCB0aGlzLnZlcnRpY2FsUmVmZXJlbmNlLCB0aGlzLnR5cGVdID0gW3gsIHksIHZlcnRpY2FsUmVmZXJlbmNlLCB0eXBlXTtcclxuICB9XHJcblxyXG4gIGdldCBob3Jpem9udGFsKCk6IHN0cmluZyB7XHJcbiAgICBzd2l0Y2ggKCB0aGlzLnR5cGUgKSB7XHJcbiAgICAgIGNhc2UgQ09OVkVSU0lPTl9VTklULlBJWEVMOlxyXG4gICAgICAgIHJldHVybiBgJHsgdGhpcy54IH1weGA7XHJcbiAgICAgIGNhc2UgQ09OVkVSU0lPTl9VTklULlBFUkNFTlRBR0U6XHJcbiAgICAgICAgcmV0dXJuIGAkeyB0aGlzLnggfSVgO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHJldHVybiBgJHsgdGhpcy54IH1weGA7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBnZXQgdmVydGljYWwoKTogc3RyaW5nIHtcclxuICAgIHN3aXRjaCAoIHRoaXMudHlwZSApIHtcclxuICAgICAgY2FzZSBDT05WRVJTSU9OX1VOSVQuUElYRUw6XHJcbiAgICAgICAgcmV0dXJuIGAkeyB0aGlzLnkgfXB4YDtcclxuICAgICAgY2FzZSBDT05WRVJTSU9OX1VOSVQuUEVSQ0VOVEFHRTpcclxuICAgICAgICByZXR1cm4gYCR7IHRoaXMueSB9JWA7XHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGAkeyB0aGlzLnkgfXB4YDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrID0ge1xyXG4gIHRvcDogYm9vbGVhbjtcclxuICByaWdodDogYm9vbGVhbjtcclxuICBjZW50ZXI6IGJvb2xlYW47XHJcbiAgYm90dG9tOiBib29sZWFuO1xyXG4gIGxlZnQ6IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSA9IHtcclxuICB0b3A6IG51bWJlcjtcclxuICByaWdodDogbnVtYmVyO1xyXG4gIGJvdHRvbTogbnVtYmVyO1xyXG4gIGxlZnQ6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJQ29sbGlzaW9uRXZlbnQge1xyXG4gIHRhcmdldENsYXNzOiBzdHJpbmc7XHJcbiAgYXV0b0luc2VydFRhcmdldENsYXNzOiBib29sZWFuO1xyXG4gIG9uQ29sbGlkaW5nKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBjb2xsaWRpbmdBdDogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIGRpc3RhbmNlRnJvbUJvcmRlcjogQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UgKTogUHJvbWlzZTx2b2lkPjtcclxuICBvbk5vdENvbGxpZGluZyggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCApOiBQcm9taXNlPHZvaWQ+O1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBDb2xsaXNpb25UcmlnZ2VyT3B0aW9ucyA9IHtcclxuICB0cmlnZ2VyRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgZXZlbnRzOiBJQ29sbGlzaW9uRXZlbnRbXTtcclxufTtcclxuXHJcbmV4cG9ydCBjbGFzcyBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZUV4dHJhcyB7XHJcbiAgY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZTtcclxuXHJcbiAgY29uc3RydWN0b3IoIGNvbGxpc2lvbkJvcmRlckRpc3RhbmNlOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApIHtcclxuICAgIHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzID0gY29sbGlzaW9uQm9yZGVyRGlzdGFuY2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYW55R3JlYXRlclRoYW4oIG51bTogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnRvcCA+IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5yaWdodCA+IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5ib3R0b20gPiBudW1cclxuICAgICAgfHwgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMubGVmdCA+IG51bTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhbnlMb3dlclRoYW4oIG51bTogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnRvcCA8IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5yaWdodCA8IG51bVxyXG4gICAgICB8fCB0aGlzLmNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcy5ib3R0b20gPCBudW1cclxuICAgICAgfHwgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMubGVmdCA8IG51bTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhbnlFcXVhbHMoIG51bTogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnRvcCA9PT0gbnVtXHJcbiAgICAgIHx8IHRoaXMuY29sbGlzaW9uQm9yZGVyRGlzdGFuY2VzLnJpZ2h0ID09PSBudW1cclxuICAgICAgfHwgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMuYm90dG9tID09PSBudW1cclxuICAgICAgfHwgdGhpcy5jb2xsaXNpb25Cb3JkZXJEaXN0YW5jZXMubGVmdCA9PT0gbnVtO1xyXG4gIH1cclxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQgfSBmcm9tICcuL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgZ2V0RWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbWFwVGFyZ2V0c0NvbGxpZGluZ0J5VHJpZ2dlckVsZW1lbnQsIGlzVmFsaWRUYXJnZXRUb1RyaWdnZXJFdmVudCB9IGZyb20gJy4vRHJhZ2dhYmxlQWN0aW9uJztcclxuaW1wb3J0IHsgUG9pbnQyRCB9IGZyb20gJy4vTWF0aFRvb2xzJztcclxuaW1wb3J0IHsgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIENvbGxpc2lvbkJvcmRlckRpc3RhbmNlLCBJQ29sbGlzaW9uRXZlbnQgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbmV4cG9ydCB0eXBlIFBpblBvc2l0aW9uRm9ybXVsYSA9ICggKCBkcmFnZ2FibGVSZWN0OiBET01SZWN0LCB0YXJnZXRSZWN0OiBET01SZWN0LCBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbjogUG9pbnQyRCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApID0+IFBvaW50MkQgKVxyXG5cclxuZXhwb3J0IHR5cGUgT25QaW5FdmVudCA9ICggKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkgPT4gdm9pZCApXHJcblxyXG5leHBvcnQgY2xhc3MgUGluQ29sbGlzaW9uRXZlbnQgaW1wbGVtZW50cyBJQ29sbGlzaW9uRXZlbnQge1xyXG4gIHByaXZhdGUgb25QaW4/OiBPblBpbkV2ZW50O1xyXG4gIHByaXZhdGUgb25VbnBpbj86IE9uUGluRXZlbnQ7XHJcbiAgcHJpdmF0ZSBwaW5Qb3NpdGlvbkZvcm11bGE/OiBQaW5Qb3NpdGlvbkZvcm11bGE7XHJcblxyXG4gIHB1YmxpYyB0YXJnZXRDbGFzczogc3RyaW5nID0gJ3Bpbi10YXJnZXQnO1xyXG4gIHB1YmxpYyBhdXRvSW5zZXJ0VGFyZ2V0Q2xhc3M6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICBjb25zdHJ1Y3RvciggeyBwaW5Qb3NpdGlvbkZvcm11bGEsIG9uUGluLCBvblVucGluIH06IHsgcGluUG9zaXRpb25Gb3JtdWxhPzogUGluUG9zaXRpb25Gb3JtdWxhLCBvblBpbj86IE9uUGluRXZlbnQsIG9uVW5waW4/OiBPblBpbkV2ZW50IH0gKSB7XHJcbiAgICB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSA9IHBpblBvc2l0aW9uRm9ybXVsYSB8fCB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLm9uUGluID0gb25QaW4gfHwgdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5vblVucGluID0gb25VbnBpbiB8fCB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgb25Db2xsaWRpbmcoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIF9jb2xsaWRpbmdBdDogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIGRpc3RhbmNlRnJvbUJvcmRlcjogQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2UgKSB7XHJcbiAgICBpZiAoICFpc1ZhbGlkVGFyZ2V0VG9UcmlnZ2VyRXZlbnQoIHRhcmdldCwgdGhpcy50YXJnZXRDbGFzcyApICkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZWxlbWVudHNJbnRlcmFjdGluZ1NldDogU2V0PEhUTUxFbGVtZW50PiA9IGdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQoIHRhcmdldCApO1xyXG4gICAgY29uc3QgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSA9ICd0b3RhbC1waW5uZWQtZWxlbWVudHMnO1xyXG4gICAgaWYgKCBkcmFnZ2FibGUuY2xhc3NMaXN0LmNvbnRhaW5zKCAnZHJhZ2dpbmcnICkgKSB7XHJcbiAgICAgIGRyYWdnYWJsZS5jbGFzc0xpc3QucmVtb3ZlKCAncGlubmVkJyApO1xyXG4gICAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LmFkZCggJ3JlYWR5LXRvLXBpbicgKTtcclxuXHJcbiAgICAgIGlmICggZWxlbWVudHNJbnRlcmFjdGluZ1NldC5kZWxldGUoIGRyYWdnYWJsZSApICkge1xyXG4gICAgICAgIHRoaXMub25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UoIHRhcmdldCwgZWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSApO1xyXG4gICAgICAgIHRoaXMub25VbnBpbiA/IHRoaXMub25VbnBpbiggZHJhZ2dhYmxlLCB0YXJnZXQgKSA6IHt9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSApIHtcclxuICAgICAgcGluRHJhZ2dhYmxlQnlGb3JtdWxhKCBkcmFnZ2FibGUsIHRhcmdldCwgZGlzdGFuY2VGcm9tQm9yZGVyLCB0aGlzLnBpblBvc2l0aW9uRm9ybXVsYSApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGluRHJhZ2dhYmxlT25DZW50ZXIoIGRyYWdnYWJsZSwgdGFyZ2V0LCBkaXN0YW5jZUZyb21Cb3JkZXIgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoICFlbGVtZW50c0ludGVyYWN0aW5nU2V0LmhhcyggZHJhZ2dhYmxlICkgKSB7XHJcbiAgICAgIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuYWRkKCBkcmFnZ2FibGUgKTtcclxuICAgICAgdGhpcy5vblBpbiA/IHRoaXMub25QaW4oIGRyYWdnYWJsZSwgdGFyZ2V0ICkgOiB7fTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZHJhZ2dhYmxlLmNsYXNzTGlzdC5hZGQoICdwaW5uZWQnICk7XHJcbiAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LnJlbW92ZSggJ3JlYWR5LXRvLXBpbicgKTtcclxuICAgIHRoaXMub25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UoIHRhcmdldCwgZWxlbWVudHNJbnRlcmFjdGluZ1NldCwgbmFtZUNvdW50RWxlbWVudHNJbnRlcmFjdGluZ0F0dHJpYnV0ZSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG9uTm90Q29sbGlkaW5nKCBkcmFnZ2FibGU6IEhUTUxFbGVtZW50LCB0YXJnZXQ6IEhUTUxFbGVtZW50ICkge1xyXG4gICAgY29uc3QgZWxlbWVudHNJbnRlcmFjdGluZ1NldDogU2V0PEhUTUxFbGVtZW50PiA9IGdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQoIHRhcmdldCApO1xyXG4gICAgZWxlbWVudHNJbnRlcmFjdGluZ1NldC5kZWxldGUoIGRyYWdnYWJsZSApO1xyXG5cclxuICAgIGlmICggZWxlbWVudHNJbnRlcmFjdGluZ1NldC5zaXplID4gMCApIHtcclxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoICdoYXMtcGlubmVkLWVsZW1lbnRzJyApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoICdoYXMtcGlubmVkLWVsZW1lbnRzJyApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggIW1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LmhhcyggZHJhZ2dhYmxlICkgKSB7XHJcbiAgICAgIG1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50LnNldCggZHJhZ2dhYmxlLCBuZXcgU2V0PEhUTUxFbGVtZW50PigpICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYWdlbnRDb2xsaXNpb25TZXQgPSBtYXBUYXJnZXRzQ29sbGlkaW5nQnlUcmlnZ2VyRWxlbWVudC5nZXQoIGRyYWdnYWJsZSApITtcclxuICAgIGlmICggYWdlbnRDb2xsaXNpb25TZXQuZGVsZXRlKCB0YXJnZXQgYXMgSFRNTEVsZW1lbnQgKSAmJiBhZ2VudENvbGxpc2lvblNldC5zaXplID09PSAwICkge1xyXG4gICAgICBkcmFnZ2FibGUuY2xhc3NMaXN0LnJlbW92ZSggJ3Bpbm5lZCcsICdyZWFkeS10by1waW4nICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uRWxlbWVudEludGVyYWN0aW9uQ2hhbmdlKCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBlbGVtZW50c0ludGVyYWN0aW5nU2V0OiBTZXQ8SFRNTEVsZW1lbnQ+LCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlOiBzdHJpbmcgKSB7XHJcbiAgICBpZiAoIGVsZW1lbnRzSW50ZXJhY3RpbmdTZXQuc2l6ZSA+IDAgKSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCAnaGFzLXBpbm5lZC1lbGVtZW50cycgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCAnaGFzLXBpbm5lZC1lbGVtZW50cycgKTtcclxuICAgIH1cclxuXHJcbiAgICB0YXJnZXQuc2V0QXR0cmlidXRlKCBuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlLCBlbGVtZW50c0ludGVyYWN0aW5nU2V0LnNpemUudG9TdHJpbmcoKSApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBpbkRyYWdnYWJsZUJ5Rm9ybXVsYSggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSwgcGluUG9zaXRpb25Gb3JtdWxhOiBQaW5Qb3NpdGlvbkZvcm11bGEgKSB7XHJcbiAgY29uc3QgdGFyZ2V0UmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICBjb25zdCBkcmFnZ2FibGVSZWN0ID0gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uID0gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIGRyYWdnYWJsZSApO1xyXG4gIGNvbnN0IHBpblBvc2l0aW9uOiBQb2ludDJEID0gcGluUG9zaXRpb25Gb3JtdWxhKCBkcmFnZ2FibGVSZWN0LCB0YXJnZXRSZWN0LCBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbiwgZGlzdGFuY2VGcm9tQm9yZGVyICk7XHJcbiAgZHJhZ2dhYmxlLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHsgcGluUG9zaXRpb24ueCB9cHgsICR7IHBpblBvc2l0aW9uLnkgfXB4KWA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwaW5EcmFnZ2FibGVPbkNlbnRlciggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgZGlzdGFuY2VGcm9tQm9yZGVyOiBDb2xsaXNpb25Cb3JkZXJEaXN0YW5jZSApIHtcclxuICBjb25zdCB0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uID0gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIGRyYWdnYWJsZSApO1xyXG4gIGNvbnN0IHRhcmdldFJpZ2h0UG9zaXRpb24gPSBkcmFnZ2FibGVUcmFuc2Zvcm1Qb3NpdGlvbi54ICsgZGlzdGFuY2VGcm9tQm9yZGVyLnJpZ2h0O1xyXG4gIGNvbnN0IHRhcmdldEJvdHRvbVBvc2l0aW9uID0gZHJhZ2dhYmxlVHJhbnNmb3JtUG9zaXRpb24ueSArIGRpc3RhbmNlRnJvbUJvcmRlci5ib3R0b207XHJcbiAgZHJhZ2dhYmxlLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHsgTWF0aC5yb3VuZCggdGFyZ2V0UmlnaHRQb3NpdGlvbiAtICggdGFyZ2V0UmVjdC53aWR0aCAvIDIgKSApIH1weCwgJHsgTWF0aC5yb3VuZCggdGFyZ2V0Qm90dG9tUG9zaXRpb24gLSAoIHRhcmdldFJlY3QuaGVpZ2h0IC8gMiApICkgfXB4KWA7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJkaWN0S2V5c0J5QWN0aW9uIiwiTWFwIiwiZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQiLCJlbGVtZW50IiwiYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGUiLCJ3aW5kb3ciLCJnZXRDb21wdXRlZFN0eWxlIiwidHJhbnNmb3JtIiwibWF0Y2giLCJyZWdleE51bWJlclBhdHRlcm4iLCJtYXAiLCJuIiwieCIsInVuZGVmaW5lZCIsIk1hdGgiLCJyb3VuZCIsInkiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwicGFpciIsImNvZGUiLCJmb3JFYWNoIiwia2JFdmVudCIsIm1hcFRhcmdldHNDb2xsaWRpbmdCeVRyaWdnZXJFbGVtZW50IiwibWFwRWxlbWVudHNUcmlnZ2VyaW5nRXZlbnRzQnlUYXJnZXQiLCJpc1ZhbGlkVGFyZ2V0VG9UcmlnZ2VyRXZlbnQiLCJjdXJyZW50VGFyZ2V0IiwidGFyZ2V0Q2xhc3NOYW1lIiwidmFsaWRhdGVEaXN0YW5jZSIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiQ29sbGlzaW9uQm9yZGVyRGlzdGFuY2VFeHRyYXMiLCJkaXN0YW5jZUZyb21Cb3JkZXIiLCJhbnlMb3dlclRoYW4iLCJkaXN0YW5jZVRocmVzaG9sZCIsImdldEVsZW1lbnRzSW50ZXJhY3RpbmdTZXQiLCJ0YXJnZXQiLCJoYXMiLCJzZXQiLCJTZXQiLCJnZXQiLCJDT05WRVJTSU9OX1VOSVQiLCJESVJFQ1RJT05fUkVGRVJFTkNFIiwiVkVSVElDQUxfUkVGRVJFTkNFIiwiQ09MT1JfQ0hBTk5FTCIsImNvbGxpc2lvbkJvcmRlckRpc3RhbmNlcyIsImNvbnN0cnVjdG9yIiwiY29sbGlzaW9uQm9yZGVyRGlzdGFuY2UiLCJ0aGlzIiwiYW55R3JlYXRlclRoYW4iLCJudW0iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJhbnlFcXVhbHMiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsIlBpbkNvbGxpc2lvbkV2ZW50Iiwib25QaW4iLCJvblVucGluIiwicGluUG9zaXRpb25Gb3JtdWxhIiwidGFyZ2V0Q2xhc3MiLCJhdXRvSW5zZXJ0VGFyZ2V0Q2xhc3MiLCJvbkNvbGxpZGluZyIsImRyYWdnYWJsZSIsIl9jb2xsaWRpbmdBdCIsImVsZW1lbnRzSW50ZXJhY3RpbmdTZXQiLCJuYW1lQ291bnRFbGVtZW50c0ludGVyYWN0aW5nQXR0cmlidXRlIiwicmVtb3ZlIiwiYWRkIiwiZGVsZXRlIiwib25FbGVtZW50SW50ZXJhY3Rpb25DaGFuZ2UiLCJwaW5EcmFnZ2FibGVCeUZvcm11bGEiLCJwaW5EcmFnZ2FibGVPbkNlbnRlciIsIm9uTm90Q29sbGlkaW5nIiwic2l6ZSIsImFnZW50Q29sbGlzaW9uU2V0Iiwic2V0QXR0cmlidXRlIiwidG9TdHJpbmciLCJ0YXJnZXRSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwicGluUG9zaXRpb24iLCJzdHlsZSIsImRyYWdnYWJsZVRyYW5zZm9ybVBvc2l0aW9uIiwidGFyZ2V0UmlnaHRQb3NpdGlvbiIsInRhcmdldEJvdHRvbVBvc2l0aW9uIiwid2lkdGgiLCJoZWlnaHQiXSwic291cmNlUm9vdCI6IiJ9